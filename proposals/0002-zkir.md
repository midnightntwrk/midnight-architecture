# Proposal 0001: ZKIR

This might be a slightly _franken-proposal_, because there are multiple problems
that we are trying to solve with ZKIR, so we might end up splitting this
proposal into multiple smaller ones.

# Problem 1: Cannot Ship Rust Compiler as a Part of the Node

We are using [ZK-Garage/plonk](https://github.com/ZK-Garage/plonk) as our
underlying proving system.  ZK-Garage/plonk is a pure Rust implementation of the
Plonk proving system.  It is essentially an embedded DSL in Rust for writing
Plonk circuits.  Therefore, ZK-Garage/plonk depends on Rust toolchain:

- circuits and gadgets are Rust programs,
- field elements are Rust structures,
- field operations are performed by Rust libraries,
- builtins are written in Rust, and
- the actual computation that needs to be proven using ZK is written in Rust.

In Midnight there are multiple points where one might want to compile a ZK
circuit, especially due to zero-trust assumptions:

- developer when writing their own SC,
- client when calling a SC,
- node when verifying a SC before accepting it on the chain,
- client when observing new transactions on the chain.

## Problem Statement

While it would be possible to require developers to use Rust toolchain, it is
not feasible to require that client and node depend on Rust toolchain to use
Midnight for various reasons (security, portability, performance, etc).


## Proposed Changes

Therefore we propose Zero-Knowledge Intermediate Representation (ZKIR) which is:

- a well defined and versioned format for low-level representation of transition
  functions, and
- an interpreter for the above format that can load it and produce a plonk
  circuit out of the aforementioned representation, which is packaged as
- a portable and statically linked library in Rust, that can be easily used
  within native programs and in WASM.


## Desired Result

We have a single artifact that we can provide to

- developers, as source code,
- node, as statically linked binary, and
- client, as WASM library.


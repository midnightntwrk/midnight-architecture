<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1334px" preserveAspectRatio="none" style="width:1408px;height:1334px;background:#FFFFFF;" version="1.1" viewBox="0 0 1408 1334" width="1408px" zoomAndPan="magnify"><defs/><g><rect height="116.8867" style="stroke:#000000;stroke-width:1.5;fill:none;" width="371.5" x="439" y="246.3066"/><rect height="649.1211" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1381" x="10" y="536.7461"/><rect height="208.1289" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1060" x="111.5" y="867.8516"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="38" x2="38" y1="141.375" y2="1202.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="147.5" x2="147.5" y1="141.375" y2="1202.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="261.5" x2="261.5" y1="141.375" y2="1202.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="485" x2="485" y1="141.375" y2="1202.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="805" x2="805" y1="141.375" y2="1202.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1108.5" x2="1108.5" y1="141.375" y2="1202.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="20" y="138.4219">User</text><ellipse cx="38.5" cy="73.3867" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M38.5,81.3867 L38.5,108.3867 M25.5,89.3867 L51.5,89.3867 M38.5,108.3867 L25.5,123.3867 M38.5,108.3867 L51.5,123.3867 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="20" y="1215.4023">User</text><ellipse cx="38.5" cy="1226.8555" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M38.5,1234.8555 L38.5,1261.8555 M25.5,1242.8555 L51.5,1242.8555 M38.5,1261.8555 L25.5,1276.8555 M38.5,1261.8555 L51.5,1276.8555 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="52" x="121.5" y="109.8867"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="128.5" y="130.4219">DApp</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="52" x="121.5" y="1201.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="128.5" y="1222.4023">DApp</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="216.5" y="109.8867"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="223.5" y="130.4219">Midnight.js</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="216.5" y="1201.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="223.5" y="1222.4023">Midnight.js</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="449" y="109.8867"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="456" y="130.4219">Contract</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="449" y="1201.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="456" y="1222.4023">Contract</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="742" y="109.8867"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="749" y="130.4219">Wallet Extension</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="742" y="1201.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="749" y="1222.4023">Wallet Extension</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106" x="1055.5" y="109.8867"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="1062.5" y="130.4219">Wallet Engine</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106" x="1055.5" y="1201.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="1062.5" y="1222.4023">Wallet Engine</text><polygon fill="#181818" points="135.5,168.6855,145.5,172.6855,135.5,176.6855,139.5,172.6855" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="38.5" x2="141.5" y1="172.6855" y2="172.6855"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="45.5" y="167.9434">trigger action</text><polygon fill="#181818" points="249.5,197.9961,259.5,201.9961,249.5,205.9961,253.5,201.9961" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147.5" x2="255.5" y1="201.9961" y2="201.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="154.5" y="197.2539">call_contract</text><polygon fill="#181818" points="473.5,227.3066,483.5,231.3066,473.5,235.3066,477.5,231.3066" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="479.5" y1="231.3066" y2="231.3066"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="268.5" y="226.5645">call</text><path d="M439,246.3066 L501,246.3066 L501,253.6172 L491,263.6172 L439,263.6172 L439,246.3066 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="116.8867" style="stroke:#000000;stroke-width:1.5;" width="371.5" x="439" y="246.3066"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="454" y="259.875">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="33" x="516" y="258.9414">[Mint]</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="485.5" x2="527.5" y1="284.9277" y2="284.9277"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="527.5" x2="527.5" y1="284.9277" y2="297.9277"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="486.5" x2="527.5" y1="297.9277" y2="297.9277"/><polygon fill="#181818" points="496.5,293.9277,486.5,297.9277,496.5,301.9277,492.5,297.9277" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="492.5" y="280.1855">mint_token(domain_sep, value, nonce, recipient)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="439" x2="810.5" y1="306.9277" y2="306.9277"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="34" x="444" y="317.5625">[Send]</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="485.5" x2="527.5" y1="342.1934" y2="342.1934"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="527.5" x2="527.5" y1="342.1934" y2="355.1934"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="486.5" x2="527.5" y1="355.1934" y2="355.1934"/><polygon fill="#181818" points="496.5,351.1934,486.5,355.1934,496.5,359.1934,492.5,355.1934" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="492.5" y="337.4512">send(input_coin, value, recipient)</text><polygon fill="#181818" points="272.5,387.5039,262.5,391.5039,272.5,395.5039,268.5,391.5039" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="266.5" x2="484.5" y1="391.5039" y2="391.5039"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="278.5" y="386.7617">create_zswap_output(new_coin)</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="303.5" y1="420.8145" y2="420.8145"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="303.5" x2="303.5" y1="420.8145" y2="433.8145"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="262.5" x2="303.5" y1="433.8145" y2="433.8145"/><polygon fill="#181818" points="272.5,429.8145,262.5,433.8145,272.5,437.8145,268.5,433.8145" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="268.5" y="416.0723">record new coin</text><polygon fill="#181818" points="272.5,459.125,262.5,463.125,272.5,467.125,268.5,463.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="266.5" x2="484.5" y1="463.125" y2="463.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="278.5" y="458.3828">return new_coin</text><polygon fill="#181818" points="793.5,488.4355,803.5,492.4355,793.5,496.4355,797.5,492.4355" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="799.5" y1="492.4355" y2="492.4355"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="268.5" y="487.6934">balance(transaction, new_coins)</text><polygon fill="#181818" points="49.5,517.7461,39.5,521.7461,49.5,525.7461,45.5,521.7461" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="43.5" x2="804.5" y1="521.7461" y2="521.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="55.5" y="517.0039">request approval</text><path d="M10,536.7461 L72,536.7461 L72,544.0566 L62,554.0566 L10,554.0566 L10,536.7461 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="649.1211" style="stroke:#000000;stroke-width:1.5;" width="1381" x="10" y="536.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="550.3145">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="88" x="87" y="549.3809">[User approves]</text><polygon fill="#181818" points="793.5,571.3672,803.5,575.3672,793.5,579.3672,797.5,575.3672" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="38.5" x2="799.5" y1="575.3672" y2="575.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="45.5" y="570.625">approve</text><polygon fill="#181818" points="1096.5,600.6777,1106.5,604.6777,1096.5,608.6777,1100.5,604.6777" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="805.5" x2="1102.5" y1="604.6777" y2="604.6777"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="812.5" y="599.9355">balance_transaction(transaction, new_coins)</text><path d="M835,617.6777 L835,642.6777 L1381,642.6777 L1381,627.6777 L1371,617.6777 L835,617.6777 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1371,617.6777 L1371,627.6777 L1381,627.6777 L1371,617.6777 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="525" x="841" y="635.2461">Collect new coins, create new self-owned outputs for positively unbalanced tokens</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1108.5" x2="1150.5" y1="669.2988" y2="669.2988"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1150.5" x2="1150.5" y1="669.2988" y2="682.2988"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1109.5" x2="1150.5" y1="682.2988" y2="682.2988"/><polygon fill="#181818" points="1119.5,678.2988,1109.5,682.2988,1119.5,686.2988,1115.5,682.2988" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="1115.5" y="664.5566">receive_tokens(transaction, new_coins)</text><path d="M982,695.2988 L982,720.2988 L1235,720.2988 L1235,705.2988 L1225,695.2988 L982,695.2988 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1225,695.2988 L1225,705.2988 L1235,705.2988 L1225,695.2988 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="988" y="712.8672">Provide balance of non-DUST tokens</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1108.5" x2="1150.5" y1="746.9199" y2="746.9199"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1150.5" x2="1150.5" y1="746.9199" y2="759.9199"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1109.5" x2="1150.5" y1="759.9199" y2="759.9199"/><polygon fill="#181818" points="1119.5,755.9199,1109.5,759.9199,1119.5,763.9199,1115.5,759.9199" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="1115.5" y="742.1777">provide_non_dust</text><path d="M937,772.9199 L937,812.9199 L1279,812.9199 L1279,782.9199 L1269,772.9199 L937,772.9199 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1269,772.9199 L1269,782.9199 L1279,782.9199 L1269,772.9199 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="943" y="790.4883">Provide balance of DUST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321" x="943" y="805.7988">all other inputs and outpus are known at this point</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1108.5" x2="1150.5" y1="839.8516" y2="839.8516"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1150.5" x2="1150.5" y1="839.8516" y2="852.8516"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1109.5" x2="1150.5" y1="852.8516" y2="852.8516"/><polygon fill="#181818" points="1119.5,848.8516,1109.5,852.8516,1119.5,856.8516,1115.5,852.8516" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="1115.5" y="835.1094">provide_dust</text><path d="M111.5,867.8516 L173.5,867.8516 L173.5,875.1621 L163.5,885.1621 L111.5,885.1621 L111.5,867.8516 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="208.1289" style="stroke:#000000;stroke-width:1.5;" width="1060" x="111.5" y="867.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="126.5" y="881.4199">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="108" x="188.5" y="880.4863">[Sufficient balance]</text><polygon fill="#181818" points="816.5,902.4727,806.5,906.4727,816.5,910.4727,812.5,906.4727" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="810.5" x2="1107.5" y1="906.4727" y2="906.4727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="822.5" y="901.7305">balanced_transaction</text><polygon fill="#181818" points="272.5,931.7832,262.5,935.7832,272.5,939.7832,268.5,935.7832" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="266.5" x2="804.5" y1="935.7832" y2="935.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="278.5" y="931.041">balanced_transaction</text><polygon fill="#181818" points="158.5,961.0938,148.5,965.0938,158.5,969.0938,154.5,965.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="152.5" x2="260.5" y1="965.0938" y2="965.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="164.5" y="960.3516">transaction_id</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="111.5" x2="1171.5" y1="974.0938" y2="974.0938"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="119" x="116.5" y="984.7285">[Insufficient balance]</text><polygon fill="#181818" points="816.5,1005.3594,806.5,1009.3594,816.5,1013.3594,812.5,1009.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="810.5" x2="1107.5" y1="1009.3594" y2="1009.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="822.5" y="1004.6172">balance_error(insufficient_balance, DUST)</text><polygon fill="#181818" points="272.5,1034.6699,262.5,1038.6699,272.5,1042.6699,268.5,1038.6699" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="266.5" x2="804.5" y1="1038.6699" y2="1038.6699"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="278.5" y="1033.9277">balance_error(insufficient_balance, DUST)</text><polygon fill="#181818" points="158.5,1063.9805,148.5,1067.9805,158.5,1071.9805,154.5,1067.9805" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="152.5" x2="260.5" y1="1067.9805" y2="1067.9805"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="164.5" y="1063.2383">error</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1391" y1="1083.9805" y2="1083.9805"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="134" x="15" y="1094.6152">[User does not approve]</text><polygon fill="#181818" points="793.5,1115.2461,803.5,1119.2461,793.5,1123.2461,797.5,1119.2461" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="38.5" x2="799.5" y1="1119.2461" y2="1119.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="45.5" y="1114.5039">not approve</text><polygon fill="#181818" points="272.5,1144.5566,262.5,1148.5566,272.5,1152.5566,268.5,1148.5566" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="266.5" x2="804.5" y1="1148.5566" y2="1148.5566"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="278.5" y="1143.8145">balance_error(user_disapproval)</text><polygon fill="#181818" points="158.5,1173.8672,148.5,1177.8672,158.5,1181.8672,154.5,1177.8672" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="152.5" x2="260.5" y1="1177.8672" y2="1177.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="164.5" y="1173.125">error</text><rect height="58.8867" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="118" x="1282" y="5"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="107" x="1293" y="14.668">balance&amp;receive.puml</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="118" x="1282" y="26.4453">2024.01.12 at 13:36 CET</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1397" y="38.2227"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1397" y="50"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1397" y="61.7773"> </text><rect height="47.1094" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="200" x="600" y="1279.3555"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="698.5" y="1289.0234"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="698.5" y="1300.8008"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="698.5" y="1312.5781"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="200" x="600" y="1324.3555">Copyright 2024, Input Output Global, Ltd.</text><!--MD5=[490d6e038f4197dd7d88bd38503dca09]
@startuml "Balance & Receive"

'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
' Please include this standard header
header %filename()\n%date("yyyy.MM.dd' at 'HH:mm z")\n\n\n
'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

actor User

participant DApp

participant "Midnight.js" as mnjs

participant "Contract" as contract

participant "Wallet Extension" as wallet_extension

participant "Wallet Engine" as wallet_engine

User - -> DApp : trigger action
DApp - -> mnjs : call_contract
mnjs - -> contract : call
alt Mint
  contract - -> contract : mint_token(domain_sep, value, nonce, recipient)
else Send
  contract - -> contract : send(input_coin, value, recipient)
end
contract - -> mnjs : create_zswap_output(new_coin)
mnjs - -> mnjs : record new coin
contract - -> mnjs : return new_coin
mnjs - -> wallet_extension : balance(transaction, new_coins)
wallet_extension - -> User : request approval
alt User approves
  User - -> wallet_extension : approve
  wallet_extension - -> wallet_engine : balance_transaction(transaction, new_coins)
  note over wallet_engine : Collect new coins, create new self-owned outputs for positively unbalanced tokens
  wallet_engine - -> wallet_engine : receive_tokens(transaction, new_coins)
  note over wallet_engine : Provide balance of non-DUST tokens
  wallet_engine - -> wallet_engine : provide_non_dust
  note over wallet_engine : Provide balance of DUST\nall other inputs and outpus are known at this point
  wallet_engine - -> wallet_engine : provide_dust
  alt Sufficient balance
    wallet_engine - -> wallet_extension : balanced_transaction
    wallet_extension - -> mnjs : balanced_transaction
    mnjs - -> DApp : transaction_id
  else Insufficient balance
    wallet_engine - -> wallet_extension : balance_error(insufficient_balance, DUST)
    wallet_extension - -> mnjs : balance_error(insufficient_balance, DUST)
    mnjs - -> DApp : error
  end
else User does not approve
  User - -> wallet_extension : not approve
  wallet_extension - -> mnjs : balance_error(user_disapproval)
  mnjs - -> DApp : error
end
'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
' Please include this standard footer
footer \n\n\nCopyright %date("yyyy"), Input Output Global, Ltd.
'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


@enduml

@startuml "Balance & Receive"

header balance&receive.puml\n2024.01.12 at 13:36 CET\n\n\n

actor User

participant DApp

participant "Midnight.js" as mnjs

participant "Contract" as contract

participant "Wallet Extension" as wallet_extension

participant "Wallet Engine" as wallet_engine

User - -> DApp : trigger action
DApp - -> mnjs : call_contract
mnjs - -> contract : call
alt Mint
  contract - -> contract : mint_token(domain_sep, value, nonce, recipient)
else Send
  contract - -> contract : send(input_coin, value, recipient)
end
contract - -> mnjs : create_zswap_output(new_coin)
mnjs - -> mnjs : record new coin
contract - -> mnjs : return new_coin
mnjs - -> wallet_extension : balance(transaction, new_coins)
wallet_extension - -> User : request approval
alt User approves
  User - -> wallet_extension : approve
  wallet_extension - -> wallet_engine : balance_transaction(transaction, new_coins)
  note over wallet_engine : Collect new coins, create new self-owned outputs for positively unbalanced tokens
  wallet_engine - -> wallet_engine : receive_tokens(transaction, new_coins)
  note over wallet_engine : Provide balance of non-DUST tokens
  wallet_engine - -> wallet_engine : provide_non_dust
  note over wallet_engine : Provide balance of DUST\nall other inputs and outpus are known at this point
  wallet_engine - -> wallet_engine : provide_dust
  alt Sufficient balance
    wallet_engine - -> wallet_extension : balanced_transaction
    wallet_extension - -> mnjs : balanced_transaction
    mnjs - -> DApp : transaction_id
  else Insufficient balance
    wallet_engine - -> wallet_extension : balance_error(insufficient_balance, DUST)
    wallet_extension - -> mnjs : balance_error(insufficient_balance, DUST)
    mnjs - -> DApp : error
  end
else User does not approve
  User - -> wallet_extension : not approve
  wallet_extension - -> mnjs : balance_error(user_disapproval)
  mnjs - -> DApp : error
end
footer \n\n\nCopyright 2024, Input Output Global, Ltd.


@enduml

PlantUML version 1.2022.3(Tue Mar 29 18:10:57 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: PL
--></g></svg>
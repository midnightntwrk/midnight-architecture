<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1240px" preserveAspectRatio="none" style="width:1818px;height:1240px;background:#FFFFFF;" version="1.1" viewBox="0 0 1818 1240" width="1818px" zoomAndPan="magnify"><defs/><g><rect fill="#EEEEFF" height="1120.1094" style="stroke:#181818;stroke-width:0.5;" width="727.75" x="160.8125" y="65.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="487.4531" y="77.27"> </text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="74.4688" x="487.4531" y="92.4028">Application</text><rect fill="#EEFFFF" height="1120.1094" style="stroke:#181818;stroke-width:0.5;" width="63" x="890.5625" y="65.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="901.8438" y="77.27"> </text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.4375" x="901.8438" y="92.4028">Wallet</text><rect fill="#FFFFEE" height="1120.1094" style="stroke:#181818;stroke-width:0.5;" width="135" x="1428.5" y="65.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="1471.0781" y="77.27"> </text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="49.8438" x="1471.0781" y="92.4028">Indexer</text><rect fill="#FFEEEE" height="1120.1094" style="stroke:#181818;stroke-width:0.5;" width="106" x="1565.5" y="65.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="1576.7656" y="77.27"> </text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="83.4688" x="1576.7656" y="92.4028">Proof Server</text><rect fill="#FFFFFF" height="964.1172" style="stroke:#181818;stroke-width:1.0;" width="10" x="202.3125" y="209.1953"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="741.0625" y="378.9922"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="833.5625" y="320.7266"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="833.5625" y="437.2578"/><rect fill="#FFFFFF" height="202.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="917.0625" y="687.3203"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1491" y="262.4609"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1491" y="1115.0469"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1613.5" y="526.6563"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1613.5" y="782.7188"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1729.5" y="919.25"/><rect height="250.1953" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1414.6875" x="154.8125" y="224.1953"/><rect height="75.3984" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1522.6875" x="154.8125" y="488.3906"/><rect height="349.4609" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1646.6875" x="154.8125" y="606.9219"/><rect height="117.5313" style="stroke:#000000;stroke-width:1.5;fill:none;" width="792.9375" x="884.5625" y="744.4531"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="178.0625" y2="1191.3125"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="206.8125" x2="206.8125" y1="178.0625" y2="1191.3125"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="745.5625" x2="745.5625" y1="178.0625" y2="1191.3125"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="838.5625" x2="838.5625" y1="178.0625" y2="1191.3125"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="921.5625" x2="921.5625" y1="178.0625" y2="1191.3125"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1495.5" x2="1495.5" y1="178.0625" y2="1191.3125"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1618.5" x2="1618.5" y1="178.0625" y2="1191.3125"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1734.5" x2="1734.5" y1="178.0625" y2="1191.3125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="174.7607">user</text><ellipse cx="23.5" cy="110.2656" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,118.2656 L23.5,145.2656 M10.5,126.2656 L36.5,126.2656 M23.5,145.2656 L10.5,160.2656 M23.5,145.2656 L36.5,160.2656 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="85" x="164.8125" y="130.4688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="205.3125" y="150.4639"> </text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="171.8125" y="166.7607">MidnightJS</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="709.5625" y="130.4688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="744.0625" y="150.4639"> </text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="716.5625" y="166.7607">Contract</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="833.5625" y="158.4639"> </text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="792.5625" y="174.7607">Private State</text><path d="M820.5625,109.4688 C820.5625,99.4688 838.5625,99.4688 838.5625,99.4688 C838.5625,99.4688 856.5625,99.4688 856.5625,109.4688 L856.5625,135.4688 C856.5625,145.4688 838.5625,145.4688 838.5625,145.4688 C838.5625,145.4688 820.5625,145.4688 820.5625,135.4688 L820.5625,109.4688 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M820.5625,109.4688 C820.5625,119.4688 838.5625,119.4688 838.5625,119.4688 C838.5625,119.4688 856.5625,119.4688 856.5625,109.4688 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="55" x="894.5625" y="146.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="901.5625" y="166.7607">Wallet</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="1432.5" y="146.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="1439.5" y="166.7607">Pub Sub Indexer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="1569.5" y="146.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1576.5" y="166.7607">Proof Server</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="1677.5" y="146.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="1684.5" y="166.7607">Midnight Node</text><rect fill="#FFFFFF" height="964.1172" style="stroke:#181818;stroke-width:1.0;" width="10" x="202.3125" y="209.1953"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="741.0625" y="378.9922"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="833.5625" y="320.7266"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="833.5625" y="437.2578"/><rect fill="#FFFFFF" height="202.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="917.0625" y="687.3203"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1491" y="262.4609"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1491" y="1115.0469"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1613.5" y="526.6563"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1613.5" y="782.7188"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1729.5" y="919.25"/><polygon fill="#181818" points="190.3125,205.1953,200.3125,209.1953,190.3125,213.1953,194.3125,209.1953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="23.5" x2="196.3125" y1="209.1953" y2="209.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="30.5" y="204.1294">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="42.9063" y="204.1294">action</text><path d="M154.8125,224.1953 L362.5313,224.1953 L362.5313,231.3281 L352.5313,241.3281 L154.8125,241.3281 L154.8125,224.1953 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="250.1953" style="stroke:#000000;stroke-width:1.5;" width="1414.6875" x="154.8125" y="224.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="162.7188" x="169.8125" y="237.2622">compute a state update</text><polygon fill="#181818" points="1479,258.4609,1489,262.4609,1479,266.4609,1483,262.4609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="1485" y1="262.4609" y2="262.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="219.3125" y="257.395">2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98.6875" x="231.7188" y="257.395">getPublicState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="334.4063" y="257.395">(blockNumber, address)</text><polygon fill="#181818" points="223.3125,287.5938,213.3125,291.5938,223.3125,295.5938,219.3125,291.5938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="217.3125" x2="1495" y1="291.5938" y2="291.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="229.3125" y="286.5278">3</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="72" x="241.7188" y="286.5278">publicState</text><polygon fill="#181818" points="821.5625,316.7266,831.5625,320.7266,821.5625,324.7266,825.5625,320.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="827.5625" y1="320.7266" y2="320.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="219.3125" y="315.6606">4</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106.0938" x="231.7188" y="315.6606">getPrivateState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="341.8125" y="315.6606">(address)</text><polygon fill="#181818" points="223.3125,345.8594,213.3125,349.8594,223.3125,353.8594,219.3125,349.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="217.3125" x2="837.5625" y1="349.8594" y2="349.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="229.3125" y="344.7935">5</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="79" x="241.7188" y="344.7935">privateState</text><polygon fill="#181818" points="729.0625,374.9922,739.0625,378.9922,729.0625,382.9922,733.0625,378.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="735.0625" y1="378.9922" y2="378.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="219.3125" y="373.9263">6</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="47.4375" x="231.7188" y="373.9263">update</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="283.1563" y="373.9263">(args, publicState, privateState)</text><polygon fill="#181818" points="223.3125,404.125,213.3125,408.125,223.3125,412.125,219.3125,408.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="217.3125" x2="745.0625" y1="408.125" y2="408.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="229.3125" y="403.0591">7</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="397" x="241.7188" y="403.0591">returnVal, privateTranscript, publicTranscript, nextPrivateState</text><polygon fill="#181818" points="821.5625,433.2578,831.5625,437.2578,821.5625,441.2578,825.5625,437.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="827.5625" y1="437.2578" y2="437.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="219.3125" y="432.1919">8</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21.2188" x="231.7188" y="432.1919">set</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="256.9375" y="432.1919">(nextPrivateState)</text><polygon fill="#181818" points="223.3125,462.3906,213.3125,466.3906,223.3125,470.3906,219.3125,466.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="217.3125" x2="837.5625" y1="466.3906" y2="466.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="229.3125" y="461.3247">9</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="22" x="241.7188" y="461.3247">ack</text><path d="M154.8125,488.3906 L411.375,488.3906 L411.375,495.5234 L401.375,505.5234 L154.8125,505.5234 L154.8125,488.3906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="75.3984" style="stroke:#000000;stroke-width:1.5;" width="1522.6875" x="154.8125" y="488.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="211.5625" x="169.8125" y="501.4575">over TLS, to TEE in Proof Server</text><polygon fill="#181818" points="1601.5,522.6563,1611.5,526.6563,1601.5,530.6563,1605.5,526.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="1607.5" y1="526.6563" y2="526.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="219.3125" y="521.5903">10</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="38.0313" x="240.125" y="521.5903">prove</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271" x="282.1563" y="521.5903">(circuit, publicTranscript, privateTranscript)</text><polygon fill="#181818" points="223.3125,551.7891,213.3125,555.7891,223.3125,559.7891,219.3125,555.7891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="217.3125" x2="1617.5" y1="555.7891" y2="555.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="229.3125" y="550.7231">11</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="33" x="250.125" y="550.7231">proof</text><polygon fill="#181818" points="34.5,587.9219,24.5,591.9219,34.5,595.9219,30.5,591.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="201.3125" y1="591.9219" y2="591.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="40.5" y="586.856">12</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="15" x="61.3125" y="586.856">ok</text><path d="M154.8125,606.9219 L378.1563,606.9219 L378.1563,614.0547 L368.1563,624.0547 L154.8125,624.0547 L154.8125,606.9219 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="349.4609" style="stroke:#000000;stroke-width:1.5;" width="1646.6875" x="154.8125" y="606.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="178.3438" x="169.8125" y="619.9888">build and send transaction</text><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="254.3125" y1="645.1875" y2="645.1875"/><line style="stroke:#181818;stroke-width:1.0;" x1="254.3125" x2="254.3125" y1="645.1875" y2="658.1875"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.3125" x2="254.3125" y1="658.1875" y2="658.1875"/><polygon fill="#181818" points="223.3125,654.1875,213.3125,658.1875,223.3125,662.1875,219.3125,658.1875" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="219.3125" y="640.1216">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="240.125" y="640.1216">unbalancedCallTx =</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="162.9375" x="370.125" y="640.1216">createUnbalancedCallTx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="537.0625" y="640.1216">(publicTranscript, proof, circuit)</text><polygon fill="#181818" points="905.0625,683.3203,915.0625,687.3203,905.0625,691.3203,909.0625,687.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="911.0625" y1="687.3203" y2="687.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="219.3125" y="682.2544">14</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52.8438" x="240.125" y="682.2544">balance</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="296.9688" y="682.2544">(unbalancedCallTx)</text><line style="stroke:#181818;stroke-width:1.0;" x1="927.0625" x2="969.0625" y1="716.4531" y2="716.4531"/><line style="stroke:#181818;stroke-width:1.0;" x1="969.0625" x2="969.0625" y1="716.4531" y2="729.4531"/><line style="stroke:#181818;stroke-width:1.0;" x1="928.0625" x2="969.0625" y1="729.4531" y2="729.4531"/><polygon fill="#181818" points="938.0625,725.4531,928.0625,729.4531,938.0625,733.4531,934.0625,729.4531" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="934.0625" y="711.3872">15</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="96" x="954.875" y="711.3872">inputs, outputs</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="11" x="1054.875" y="711.3872">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="77.4688" x="1069.875" y="711.3872">selectCoins</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="1151.3438" y="711.3872">(callTx)</text><path d="M884.5625,744.4531 L1141.125,744.4531 L1141.125,751.5859 L1131.125,761.5859 L884.5625,761.5859 L884.5625,744.4531 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="117.5313" style="stroke:#000000;stroke-width:1.5;" width="792.9375" x="884.5625" y="744.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="211.5625" x="899.5625" y="757.52">over TLS, to TEE in Proof Server</text><polygon fill="#181818" points="1601.5,778.7188,1611.5,782.7188,1601.5,786.7188,1605.5,782.7188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="927.0625" x2="1607.5" y1="782.7188" y2="782.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="934.0625" y="777.6528">16</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="38.0313" x="954.875" y="777.6528">prove</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="996.9063" y="777.6528">(unbalancedCallTx, inputs, outputs)</text><polygon fill="#181818" points="938.0625,807.8516,928.0625,811.8516,938.0625,815.8516,934.0625,811.8516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="932.0625" x2="1617.5" y1="811.8516" y2="811.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="944.0625" y="806.7856">17</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="33" x="964.875" y="806.7856">proof</text><line style="stroke:#181818;stroke-width:1.0;" x1="927.0625" x2="969.0625" y1="840.9844" y2="840.9844"/><line style="stroke:#181818;stroke-width:1.0;" x1="969.0625" x2="969.0625" y1="840.9844" y2="853.9844"/><line style="stroke:#181818;stroke-width:1.0;" x1="928.0625" x2="969.0625" y1="853.9844" y2="853.9844"/><polygon fill="#181818" points="938.0625,849.9844,928.0625,853.9844,938.0625,857.9844,934.0625,853.9844" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="934.0625" y="835.9185">18</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="95" x="954.875" y="835.9185">balancedCallTx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="11" x="1053.875" y="835.9185">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="145.125" x="1068.875" y="835.9185">createBalancedCallTx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="1218" y="835.9185">(unbalancedCallTx, proof, inputs, outputs)</text><polygon fill="#181818" points="223.3125,886.1172,213.3125,890.1172,223.3125,894.1172,219.3125,890.1172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="217.3125" x2="921.0625" y1="890.1172" y2="890.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="229.3125" y="885.0513">19</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="95" x="250.125" y="885.0513">balancedCallTx</text><polygon fill="#181818" points="1717.5,915.25,1727.5,919.25,1717.5,923.25,1721.5,919.25" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="1723.5" y1="919.25" y2="919.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="219.3125" y="914.1841">20</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61.25" x="240.125" y="914.1841">submitTx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="305.375" y="914.1841">(balancedCallTx)</text><polygon fill="#181818" points="223.3125,944.3828,213.3125,948.3828,223.3125,952.3828,219.3125,948.3828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="217.3125" x2="1733.5" y1="948.3828" y2="948.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="229.3125" y="943.3169">21</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="51" x="250.125" y="943.3169">pending</text><polygon fill="#181818" points="34.5,980.5156,24.5,984.5156,34.5,988.5156,30.5,984.5156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="201.3125" y1="984.5156" y2="984.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="40.5" y="979.4497">22</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="51" x="61.3125" y="979.4497">pending</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1811.5" x="0" y="1013.082"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1811.5" y1="1013.082" y2="1013.082"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1811.5" y1="1016.082" y2="1016.082"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="319.0313" x="746.2344" y="1002.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="301.0313" x="752.2344" y="1018.5825">time passes as TX is verified and propagated</text><polygon fill="#181818" points="933.0625,1052.7813,923.0625,1056.7813,933.0625,1060.7813,929.0625,1056.7813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="927.0625" x2="1733.5" y1="1056.7813" y2="1056.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="939.0625" y="1051.7153">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="959.875" y="1051.7153">verified tx, new public state</text><polygon fill="#181818" points="1507,1081.9141,1497,1085.9141,1507,1089.9141,1503,1085.9141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1501" x2="1733.5" y1="1085.9141" y2="1085.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="1513" y="1080.8481">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="1533.8125" y="1080.8481">verified tx, new public state</text><polygon fill="#181818" points="1479,1111.0469,1489,1115.0469,1479,1119.0469,1483,1115.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="1485" y1="1115.0469" y2="1115.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="219.3125" y="1109.981">25</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="69.4688" x="240.125" y="1109.981">isFinalized</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="313.5938" y="1109.981">(balancedCallTx.id)</text><polygon fill="#181818" points="223.3125,1140.1797,213.3125,1144.1797,223.3125,1148.1797,219.3125,1144.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="217.3125" x2="1495" y1="1144.1797" y2="1144.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="229.3125" y="1139.1138">26</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="68" x="250.125" y="1139.1138">tx finalized</text><polygon fill="#181818" points="34.5,1169.3125,24.5,1173.3125,34.5,1177.3125,30.5,1173.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="206.3125" y1="1173.3125" y2="1173.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="40.5" y="1168.2466">27</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="134" x="61.3125" y="1168.2466">outcome information</text><rect height="58.2031" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="121" x="1689.5" y="5"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1807.5" y="14.2822"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="121" x="1689.5" y="25.9229">2023.06.02 at 18:46 UTC</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1807.5" y="37.5635"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1807.5" y="49.2041"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1807.5" y="60.8447"> </text><rect height="46.5625" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="225" x="792.75" y="1186.3125"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="903.75" y="1195.5947"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="903.75" y="1207.2354"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="903.75" y="1218.876"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="225" x="792.75" y="1230.5166">Copyright 2023, Input Output Hong Kong, Ltd.</text><!--MD5=[e9af0d5faf6095a5b89b34d8f303caf6]
@startuml
autonumber
hide footbox

'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
' Please include this standard header
header %filename()\n%date("yyyy.MM.dd' at 'HH:mm z")\n\n\n
'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

actor user

box "\nApplication" #eef
        participant "\nMidnightJS" as midnightjs
        participant "\nContract" as contract
        database "\nPrivate State" as privateStateStore
end box

box "\nWallet" #eff
    'The browser extension
    participant "Wallet" as wallet
end box

box "\nIndexer" #ffe
    participant "Pub Sub Indexer" as indexer
end box

box "\nProof Server" #fee
    participant "Proof Server" as proofServer
end box

participant "Midnight Node" as midnightNode

'==================================================================

    user -> midnightjs ++: action

    group compute a state update
        midnightjs -> indexer ++: **getPublicState** (blockNumber, address)
        return //publicState//
        midnightjs -> privateStateStore ++: **getPrivateState** (address)
        return //privateState//
        midnightjs -> contract ++: **update** (args, publicState, privateState)
        return //returnVal, privateTranscript, publicTranscript, nextPrivateState//
        midnightjs -> privateStateStore ++: **set** (nextPrivateState)
        return //ack//
    end

    group over TLS, to TEE in Proof Server
        midnightjs -> proofServer ++: **prove** (circuit, publicTranscript, privateTranscript)
        return //proof//
    end
    midnightjs - -> user: //ok//

    group build and send transaction
        midnightjs -> midnightjs : unbalancedCallTx = **createUnbalancedCallTx** (publicTranscript, proof, circuit)
        midnightjs -> wallet ++: **balance** (unbalancedCallTx)
        wallet -> wallet : //inputs, outputs// = **selectCoins** (callTx)
        group over TLS, to TEE in Proof Server
            wallet -> proofServer ++: **prove** (unbalancedCallTx, inputs, outputs)
            return //proof//
            wallet -> wallet : //balancedCallTx// = **createBalancedCallTx** (unbalancedCallTx, proof, inputs, outputs)
        end
        return //balancedCallTx//
        midnightjs -> midnightNode ++: **submitTx** (balancedCallTx)
        return //pending//
    end
    midnightjs - -> user: //pending//

    == time passes as TX is verified and propagated ==
    midnightNode -> wallet : verified tx, new public state
    midnightNode -> indexer : verified tx, new public state
    midnightjs -> indexer ++: **isFinalized** (balancedCallTx.id)
    return //tx finalized//
    midnightjs - -> user : //outcome information//
    deactivate midnightjs

'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
' Please include this standard footer
footer \n\n\nCopyright %date("yyyy"), Input Output Hong Kong, Ltd.
'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

@enduml

@startuml
autonumber
hide footbox

header \n2023.06.02 at 18:46 UTC\n\n\n

actor user

box "\nApplication" #eef
        participant "\nMidnightJS" as midnightjs
        participant "\nContract" as contract
        database "\nPrivate State" as privateStateStore
end box

box "\nWallet" #eff
    participant "Wallet" as wallet
end box

box "\nIndexer" #ffe
    participant "Pub Sub Indexer" as indexer
end box

box "\nProof Server" #fee
    participant "Proof Server" as proofServer
end box

participant "Midnight Node" as midnightNode


    user -> midnightjs ++: action

    group compute a state update
        midnightjs -> indexer ++: **getPublicState** (blockNumber, address)
        return //publicState//
        midnightjs -> privateStateStore ++: **getPrivateState** (address)
        return //privateState//
        midnightjs -> contract ++: **update** (args, publicState, privateState)
        return //returnVal, privateTranscript, publicTranscript, nextPrivateState//
        midnightjs -> privateStateStore ++: **set** (nextPrivateState)
        return //ack//
    end

    group over TLS, to TEE in Proof Server
        midnightjs -> proofServer ++: **prove** (circuit, publicTranscript, privateTranscript)
        return //proof//
    end
    midnightjs - -> user: //ok//

    group build and send transaction
        midnightjs -> midnightjs : unbalancedCallTx = **createUnbalancedCallTx** (publicTranscript, proof, circuit)
        midnightjs -> wallet ++: **balance** (unbalancedCallTx)
        wallet -> wallet : //inputs, outputs// = **selectCoins** (callTx)
        group over TLS, to TEE in Proof Server
            wallet -> proofServer ++: **prove** (unbalancedCallTx, inputs, outputs)
            return //proof//
            wallet -> wallet : //balancedCallTx// = **createBalancedCallTx** (unbalancedCallTx, proof, inputs, outputs)
        end
        return //balancedCallTx//
        midnightjs -> midnightNode ++: **submitTx** (balancedCallTx)
        return //pending//
    end
    midnightjs - -> user: //pending//

    == time passes as TX is verified and propagated ==
    midnightNode -> wallet : verified tx, new public state
    midnightNode -> indexer : verified tx, new public state
    midnightjs -> indexer ++: **isFinalized** (balancedCallTx.id)
    return //tx finalized//
    midnightjs - -> user : //outcome information//
    deactivate midnightjs

footer \n\n\nCopyright 2023, Input Output Hong Kong, Ltd.

@enduml

PlantUML version 1.2022.3(Tue Mar 29 16:10:57 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>
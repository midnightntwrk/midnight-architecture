<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2509px" preserveAspectRatio="none" style="width:1536px;height:2509px;background:#FFFFFF;" version="1.1" viewBox="0 0 1536 2509" width="1536px" zoomAndPan="magnify"><defs/><g><rect fill="#EEEEFF" height="2388.2734" style="stroke:#181818;stroke-width:0.5;" width="333.8125" x="226.3125" y="65.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="34.625" x="375.9063" y="77.27">dApp</text><rect fill="#EEFFEE" height="2388.2734" style="stroke:#181818;stroke-width:0.5;" width="273.8125" x="562.125" y="65.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="104.6875" x="646.6875" y="77.27">Wallet Frontend</text><rect fill="#DDDDDD" height="2388.2734" style="stroke:#181818;stroke-width:0.5;" width="128" x="837.9375" y="65.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102.2813" x="850.7969" y="77.27">Wallet Backend</text><rect fill="#FFEEEE" height="2388.2734" style="stroke:#181818;stroke-width:0.5;" width="172.125" x="1005.75" y="65.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.125" x="1008.75" y="77.27">Proof Server Component</text><rect fill="#FFFFFF" height="1382.3047" style="stroke:#181818;stroke-width:1.0;" width="10" x="250.3125" y="210.3594"/><rect fill="#FFFFFF" height="104.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="436.125" y="293.8906"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="519.125" y="632.8828"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="519.125" y="2188.0547"/><rect fill="#FFFFFF" height="834.25" style="stroke:#181818;stroke-width:1.0;" width="10" x="588.625" y="722.2813"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="804.4375" y="775.5469"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="804.4375" y="1375.7344"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="804.4375" y="1963.125"/><rect fill="#FFFFFF" height="538.125" style="stroke:#181818;stroke-width:1.0;" width="10" x="896.9375" y="1469.1328"/><rect fill="#FFFFFF" height="79.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1086.8125" y="502.2188"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1086.8125" y="1207.8047"/><rect height="444.6563" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1059" x="132" y="225.3594"/><rect height="175.9297" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1039" x="142" y="413.6875"/><rect height="880.5156" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1481.375" x="38" y="684.0156"/><rect height="117.5313" style="stroke:#000000;stroke-width:1.5;fill:none;" width="285.8125" x="556.125" y="737.2813"/><rect height="236.4609" style="stroke:#000000;stroke-width:1.5;fill:none;" width="811" x="48" y="868.8125"/><rect height="75.3984" style="stroke:#000000;stroke-width:1.5;fill:none;" width="574.6875" x="556.125" y="1169.5391"/><rect height="88.3984" style="stroke:#000000;stroke-width:1.5;fill:none;" width="687.4375" x="831.9375" y="1685.9297"/><rect height="133.6641" style="stroke:#000000;stroke-width:1.5;fill:none;" width="415.8125" x="556.125" y="1866.5938"/><rect height="289.1953" style="stroke:#000000;stroke-width:1.5;fill:none;" width="583.125" x="48" y="2049.3906"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="76" x2="76" y1="179.2266" y2="2355.5859"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="255.3125" x2="255.3125" y1="179.2266" y2="2355.5859"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="441.125" x2="441.125" y1="179.2266" y2="2355.5859"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="524.125" x2="524.125" y1="179.2266" y2="2355.5859"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="593.125" x2="593.125" y1="179.2266" y2="2355.5859"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="808.9375" x2="808.9375" y1="179.2266" y2="2355.5859"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="901.9375" x2="901.9375" y1="179.2266" y2="2355.5859"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1091.8125" x2="1091.8125" y1="179.2266" y2="2355.5859"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1466.375" x2="1466.375" y1="179.2266" y2="2355.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="58" y="175.9248">user</text><ellipse cx="76.5" cy="111.4297" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M76.5,119.4297 L76.5,146.4297 M63.5,127.4297 L89.5,127.4297 M76.5,146.4297 L63.5,161.4297 M76.5,146.4297 L89.5,161.4297 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="58" y="2367.5811">user</text><ellipse cx="76.5" cy="2379.3828" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M76.5,2387.3828 L76.5,2414.3828 M63.5,2395.3828 L89.5,2395.3828 M76.5,2414.3828 L63.5,2429.3828 M76.5,2414.3828 L89.5,2429.3828 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="50" x="230.3125" y="147.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="237.3125" y="167.9248">dApp</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="50" x="230.3125" y="2354.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="237.3125" y="2374.5811">dApp</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="400.125" y="131.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="407.125" y="151.6279">Transition</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="411.125" y="167.9248">Function</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="400.125" y="2354.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="407.125" y="2374.5811">Transition</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="411.125" y="2390.8779">Function</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="492.625" y="143.3311">Pending</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="498.125" y="159.6279">Private</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="492.125" y="175.9248">Updates</text><path d="M506.125,94.3359 C506.125,84.3359 524.125,84.3359 524.125,84.3359 C524.125,84.3359 542.125,84.3359 542.125,94.3359 L542.125,120.3359 C542.125,130.3359 524.125,130.3359 524.125,130.3359 C524.125,130.3359 506.125,130.3359 506.125,120.3359 L506.125,94.3359 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M506.125,94.3359 C506.125,104.3359 524.125,104.3359 524.125,104.3359 C524.125,104.3359 542.125,104.3359 542.125,94.3359 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="492.625" y="2367.5811">Pending</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="498.125" y="2383.8779">Private</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="492.125" y="2400.1748">Updates</text><path d="M506.125,2413.4766 C506.125,2403.4766 524.125,2403.4766 524.125,2403.4766 C524.125,2403.4766 542.125,2403.4766 542.125,2413.4766 L542.125,2439.4766 C542.125,2449.4766 524.125,2449.4766 524.125,2449.4766 C524.125,2449.4766 506.125,2449.4766 506.125,2439.4766 L506.125,2413.4766 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M506.125,2413.4766 C506.125,2423.4766 524.125,2423.4766 524.125,2423.4766 C524.125,2423.4766 542.125,2423.4766 542.125,2413.4766 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="55" x="566.125" y="147.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="573.125" y="167.9248">Wallet</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="55" x="566.125" y="2354.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="573.125" y="2374.5811">Wallet</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="786.9375" y="159.6279">Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="790.4375" y="175.9248">Data</text><path d="M791.4375,110.6328 C791.4375,100.6328 809.4375,100.6328 809.4375,100.6328 C809.4375,100.6328 827.4375,100.6328 827.4375,110.6328 L827.4375,136.6328 C827.4375,146.6328 809.4375,146.6328 809.4375,146.6328 C809.4375,146.6328 791.4375,146.6328 791.4375,136.6328 L791.4375,110.6328 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M791.4375,110.6328 C791.4375,120.6328 809.4375,120.6328 809.4375,120.6328 C809.4375,120.6328 827.4375,120.6328 827.4375,110.6328 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="786.9375" y="2367.5811">Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="790.4375" y="2383.8779">Data</text><path d="M791.4375,2397.1797 C791.4375,2387.1797 809.4375,2387.1797 809.4375,2387.1797 C809.4375,2387.1797 827.4375,2387.1797 827.4375,2397.1797 L827.4375,2423.1797 C827.4375,2433.1797 809.4375,2433.1797 809.4375,2433.1797 C809.4375,2433.1797 791.4375,2433.1797 791.4375,2423.1797 L791.4375,2397.1797 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M791.4375,2397.1797 C791.4375,2407.1797 809.4375,2407.1797 809.4375,2407.1797 C809.4375,2407.1797 827.4375,2407.1797 827.4375,2397.1797 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="120" x="841.9375" y="147.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="848.9375" y="167.9248">Wallet Backend</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="120" x="841.9375" y="2354.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="848.9375" y="2374.5811">Wallet Backend</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="58" x="1062.8125" y="131.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="1073.8125" y="151.6279">Proof</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="1069.8125" y="167.9248">Server</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="58" x="1062.8125" y="2354.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="1073.8125" y="2374.5811">Proof</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="1069.8125" y="2390.8779">Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1424.375" y="175.9248">Consensus</text><path d="M1446.375,134.9297 L1446.375,158.9297 M1446.375,146.9297 L1463.375,146.9297 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="1475.375" cy="146.9297" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1424.375" y="2367.5811">Consensus</text><path d="M1446.375,2374.8828 L1446.375,2398.8828 M1446.375,2386.8828 L1463.375,2386.8828 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="1475.375" cy="2386.8828" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#FFFFFF" height="1382.3047" style="stroke:#181818;stroke-width:1.0;" width="10" x="250.3125" y="210.3594"/><rect fill="#FFFFFF" height="104.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="436.125" y="293.8906"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="519.125" y="632.8828"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="519.125" y="2188.0547"/><rect fill="#FFFFFF" height="834.25" style="stroke:#181818;stroke-width:1.0;" width="10" x="588.625" y="722.2813"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="804.4375" y="775.5469"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="804.4375" y="1375.7344"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="804.4375" y="1963.125"/><rect fill="#FFFFFF" height="538.125" style="stroke:#181818;stroke-width:1.0;" width="10" x="896.9375" y="1469.1328"/><rect fill="#FFFFFF" height="79.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1086.8125" y="502.2188"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1086.8125" y="1207.8047"/><polygon fill="#181818" points="238.3125,206.3594,248.3125,210.3594,238.3125,214.3594,242.3125,210.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="76.5" x2="244.3125" y1="210.3594" y2="210.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="83.5" y="205.2935">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="95.9063" y="205.2935">action</text><path d="M132,225.3594 L407.9688,225.3594 L407.9688,232.4922 L397.9688,242.4922 L132,242.4922 L132,225.3594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="444.6563" style="stroke:#000000;stroke-width:1.5;" width="1059" x="132" y="225.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="230.9688" x="147" y="238.4263">compute and store a state update</text><polygon fill="#181818" points="424.125,289.8906,434.125,293.8906,424.125,297.8906,428.125,293.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="260.3125" x2="430.125" y1="293.8906" y2="293.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="267.3125" y="273.6919">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="279.7188" y="258.5591">update(args) using</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="287.7188" y="273.6919">public state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="287.7188" y="288.8247">private state</text><polygon fill="#181818" points="271.3125,394.6875,261.3125,398.6875,271.3125,402.6875,267.3125,398.6875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="265.3125" x2="440.125" y1="398.6875" y2="398.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="277.3125" y="355.7896">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="289.7188" y="317.9575">ok(result,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="309.7188" y="333.0903">new public state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="309.7188" y="348.2231">new private state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="309.7188" y="363.356">private transcript,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="309.7188" y="378.4888">public transcript,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="309.7188" y="393.6216">witness)</text><path d="M142,413.6875 L396.5625,413.6875 L396.5625,420.8203 L386.5625,430.8203 L142,430.8203 L142,413.6875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="175.9297" style="stroke:#000000;stroke-width:1.5;" width="1039" x="142" y="413.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="209.5625" x="157" y="426.7544">over TLS, to TEE in proof server</text><path d="M152,435.8203 L152,475.8203 L357,475.8203 L357,445.8203 L347,435.8203 L152,435.8203 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M347,435.8203 L347,445.8203 L357,445.8203 L347,435.8203 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="158" y="452.8872">witness includes private data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="158" y="468.02">not shared with Wallet</text><polygon fill="#181818" points="1074.8125,498.2188,1084.8125,502.2188,1074.8125,506.2188,1078.8125,502.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="260.3125" x2="1080.8125" y1="502.2188" y2="502.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="267.3125" y="497.1528">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="279.7188" y="497.1528">prove(circuit, witness)</text><path d="M1011,515.2188 L1011,555.2188 L1171,555.2188 L1171,525.2188 L1161,515.2188 L1011,515.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1161,515.2188 L1161,525.2188 L1171,525.2188 L1161,515.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="1017" y="532.2856">omitting details of</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="1017" y="547.4185">session management</text><polygon fill="#181818" points="271.3125,577.6172,261.3125,581.6172,271.3125,585.6172,267.3125,581.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="265.3125" x2="1090.8125" y1="581.6172" y2="581.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="277.3125" y="576.5513">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="289.7188" y="576.5513">proof</text><polygon fill="#181818" points="507.125,628.8828,517.125,632.8828,507.125,636.8828,511.125,632.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="260.3125" x2="513.125" y1="632.8828" y2="632.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="267.3125" y="620.2505">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="279.7188" y="612.6841">store pending private</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="279.7188" y="627.8169">transcript indexed by tx</text><polygon fill="#181818" points="271.3125,658.0156,261.3125,662.0156,271.3125,666.0156,267.3125,662.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="265.3125" x2="523.125" y1="662.0156" y2="662.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="277.3125" y="656.9497">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="289.7188" y="656.9497">ok</text><path d="M38,684.0156 L261.3438,684.0156 L261.3438,691.1484 L251.3438,701.1484 L38,701.1484 L38,684.0156 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="880.5156" style="stroke:#000000;stroke-width:1.5;" width="1481.375" x="38" y="684.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="178.3438" x="53" y="697.0825">build and send transaction</text><polygon fill="#181818" points="576.625,718.2813,586.625,722.2813,576.625,726.2813,580.625,722.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="260.3125" x2="582.625" y1="722.2813" y2="722.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="267.3125" y="717.2153">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="279.7188" y="717.2153">make call tx (call, transcripts)</text><path d="M556.125,737.2813 L714.2188,737.2813 L714.2188,744.4141 L704.2188,754.4141 L556.125,754.4141 L556.125,737.2813 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="117.5313" style="stroke:#000000;stroke-width:1.5;" width="285.8125" x="556.125" y="737.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="113.0938" x="571.125" y="750.3481">identify payment</text><polygon fill="#181818" points="792.4375,771.5469,802.4375,775.5469,792.4375,779.5469,796.4375,775.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="598.625" x2="798.4375" y1="775.5469" y2="775.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="605.625" y="770.481">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="618.0313" y="770.481">fetch coins</text><polygon fill="#181818" points="609.625,800.6797,599.625,804.6797,609.625,808.6797,605.625,804.6797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="603.625" x2="808.4375" y1="804.6797" y2="804.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="615.625" y="799.6138">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="636.4375" y="799.6138">coins</text><line style="stroke:#181818;stroke-width:1.0;" x1="598.625" x2="640.625" y1="833.8125" y2="833.8125"/><line style="stroke:#181818;stroke-width:1.0;" x1="640.625" x2="640.625" y1="833.8125" y2="846.8125"/><line style="stroke:#181818;stroke-width:1.0;" x1="599.625" x2="640.625" y1="846.8125" y2="846.8125"/><polygon fill="#181818" points="609.625,842.8125,599.625,846.8125,609.625,850.8125,605.625,846.8125" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="605.625" y="828.7466">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="626.4375" y="828.7466">estimate cost, select coins</text><path d="M48,868.8125 L228.7188,868.8125 L228.7188,875.9453 L218.7188,885.9453 L48,885.9453 L48,868.8125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="236.4609" style="stroke:#000000;stroke-width:1.5;" width="811" x="48" y="868.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="135.7188" x="63" y="881.8794">obtain authorization</text><path d="M337,890.9453 L337,960.9453 L849,960.9453 L849,900.9453 L839,890.9453 L337,890.9453 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M839,890.9453 L839,900.9453 L849,900.9453 L839,890.9453 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="393" x="343" y="908.0122">now we have all the data needed to ask user for authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="343" y="923.145">though a 2-stage process may be better suited:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="487" x="347" y="938.2778">- first dApp asks if can interact with wallet at all(and user confirms or rejects)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="336" x="347" y="953.4106">- then wallet asks user for each separate transaction</text><path d="M355,971.4766 L355,1026.4766 L831,1026.4766 L831,981.4766 L821,971.4766 L355,971.4766 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M821,971.4766 L821,981.4766 L831,981.4766 L821,971.4766 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="347" x="361" y="988.5435">alternative flow: user pre-authorizes to avoid this step.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="417" x="361" y="1003.6763">Depending on time it takes to calculate SC ZK-proofs (steps 4, 5)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="455" x="361" y="1018.8091">the user experience may require moving user authorization step earlier</text><polygon fill="#181818" points="87.5,1064.1406,77.5,1068.1406,87.5,1072.1406,83.5,1068.1406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="81.5" x2="587.625" y1="1068.1406" y2="1068.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="93.5" y="1055.5083">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="114.3125" y="1047.9419">request authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="114.3125" y="1063.0747">of leakage report &amp; coins</text><polygon fill="#181818" points="576.625,1093.2734,586.625,1097.2734,576.625,1101.2734,580.625,1097.2734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="76.5" x2="582.625" y1="1097.2734" y2="1097.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="83.5" y="1092.2075">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="104.3125" y="1092.2075">authorized</text><path d="M470,1117.2734 L470,1157.2734 L717,1157.2734 L717,1127.2734 L707,1117.2734 L470,1117.2734 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M707,1117.2734 L707,1127.2734 L717,1127.2734 L707,1117.2734 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="476" y="1134.3403">Now perform the expensive spend</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="476" y="1149.4731">proofs to complete the transaction.</text><path d="M556.125,1169.5391 L810.6875,1169.5391 L810.6875,1176.6719 L800.6875,1186.6719 L556.125,1186.6719 L556.125,1169.5391 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="75.3984" style="stroke:#000000;stroke-width:1.5;" width="574.6875" x="556.125" y="1169.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="209.5625" x="571.125" y="1182.606">over TLS, to TEE in proof server</text><polygon fill="#181818" points="1074.8125,1203.8047,1084.8125,1207.8047,1074.8125,1211.8047,1078.8125,1207.8047" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="598.625" x2="1080.8125" y1="1207.8047" y2="1207.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="605.625" y="1202.7388">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="626.4375" y="1202.7388">prove spend</text><polygon fill="#181818" points="609.625,1232.9375,599.625,1236.9375,609.625,1240.9375,605.625,1236.9375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="603.625" x2="1090.8125" y1="1236.9375" y2="1236.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="615.625" y="1231.8716">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="636.4375" y="1231.8716">spendProof</text><line style="stroke:#181818;stroke-width:1.0;" x1="598.625" x2="640.625" y1="1333.6016" y2="1333.6016"/><line style="stroke:#181818;stroke-width:1.0;" x1="640.625" x2="640.625" y1="1333.6016" y2="1346.6016"/><line style="stroke:#181818;stroke-width:1.0;" x1="599.625" x2="640.625" y1="1346.6016" y2="1346.6016"/><polygon fill="#181818" points="609.625,1342.6016,599.625,1346.6016,609.625,1350.6016,605.625,1346.6016" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="605.625" y="1298.27">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="626.4375" y="1268.0044">build tx 'call' using</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="634.4375" y="1283.1372">contractId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="634.4375" y="1298.27">public transcript,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="634.4375" y="1313.4028">proof,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="634.4375" y="1328.5356">coins</text><polygon fill="#181818" points="792.4375,1371.7344,802.4375,1375.7344,792.4375,1379.7344,796.4375,1375.7344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="598.625" x2="798.4375" y1="1375.7344" y2="1375.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="605.625" y="1370.6685">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="626.4375" y="1370.6685">savePending(tx)</text><polygon fill="#181818" points="609.625,1400.8672,599.625,1404.8672,609.625,1408.8672,605.625,1404.8672" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="603.625" x2="808.4375" y1="1404.8672" y2="1404.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="615.625" y="1399.8013">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="636.4375" y="1399.8013">ok</text><path d="M708,1417.8672 L708,1442.8672 L1094,1442.8672 L1094,1427.8672 L1084,1417.8672 L708,1417.8672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1084,1417.8672 L1084,1427.8672 L1094,1427.8672 L1084,1417.8672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="365" x="714" y="1434.9341">omitting details of initialization and session management</text><polygon fill="#181818" points="884.9375,1465.1328,894.9375,1469.1328,884.9375,1473.1328,888.9375,1469.1328" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="598.625" x2="890.9375" y1="1469.1328" y2="1469.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="605.625" y="1464.0669">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="626.4375" y="1464.0669">submitTx(tx)</text><polygon fill="#181818" points="1454.875,1494.2656,1464.875,1498.2656,1454.875,1502.2656,1458.875,1498.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="906.9375" x2="1460.875" y1="1498.2656" y2="1498.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="913.9375" y="1493.1997">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="409" x="934.75" y="1493.1997">submitTx(call, circuitId, proof, spendIns, spendOuts, spendProof)</text><polygon fill="#181818" points="609.625,1523.3984,599.625,1527.3984,609.625,1531.3984,605.625,1527.3984" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="603.625" x2="895.9375" y1="1527.3984" y2="1527.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="615.625" y="1522.3325">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="636.4375" y="1522.3325">submitted</text><polygon fill="#181818" points="271.3125,1552.5313,261.3125,1556.5313,271.3125,1560.5313,267.3125,1556.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="265.3125" x2="592.625" y1="1556.5313" y2="1556.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="277.3125" y="1551.4653">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="298.125" y="1551.4653">submitted</text><polygon fill="#181818" points="87.5,1588.6641,77.5,1592.6641,87.5,1596.6641,83.5,1592.6641" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="81.5" x2="254.3125" y1="1592.6641" y2="1592.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="93.5" y="1587.5981">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="114.3125" y="1587.5981">pending</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1529.375" x="0" y="1621.2305"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1529.375" y1="1621.2305" y2="1621.2305"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1529.375" y1="1624.2305" y2="1624.2305"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="319.0313" x="605.1719" y="1610.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="301.0313" x="611.1719" y="1626.731">time passes as TX is verified and propageted</text><path d="M19,1648.7969 L19,1673.7969 L133,1673.7969 L133,1658.7969 L123,1648.7969 L19,1648.7969 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M123,1648.7969 L123,1658.7969 L133,1658.7969 L123,1648.7969 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="25" y="1665.8638">possibly offline</text><path d="M831.9375,1685.9297 L1120.125,1685.9297 L1120.125,1693.0625 L1110.125,1703.0625 L831.9375,1703.0625 L831.9375,1685.9297 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="88.3984" style="stroke:#000000;stroke-width:1.5;" width="687.4375" x="831.9375" y="1685.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="243.1875" x="846.9375" y="1698.9966">Wallet Backend observes consensus</text><polygon fill="#181818" points="917.9375,1720.1953,907.9375,1724.1953,917.9375,1728.1953,913.9375,1724.1953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="911.9375" x2="1465.875" y1="1724.1953" y2="1724.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="923.9375" y="1719.1294">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="944.75" y="1719.1294">verified tx and new public state</text><line style="stroke:#181818;stroke-width:1.0;" x1="906.9375" x2="948.9375" y1="1753.3281" y2="1753.3281"/><line style="stroke:#181818;stroke-width:1.0;" x1="948.9375" x2="948.9375" y1="1753.3281" y2="1766.3281"/><line style="stroke:#181818;stroke-width:1.0;" x1="907.9375" x2="948.9375" y1="1766.3281" y2="1766.3281"/><polygon fill="#181818" points="917.9375,1762.3281,907.9375,1766.3281,917.9375,1770.3281,913.9375,1766.3281" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="913.9375" y="1748.2622">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="934.75" y="1748.2622">store for client</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1529.375" x="0" y="1801.8945"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1529.375" y1="1801.8945" y2="1801.8945"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1529.375" y1="1804.8945" y2="1804.8945"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="499.9688" x="514.7031" y="1791.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="481.9688" x="520.7031" y="1807.395">time passes until Wallet Front End polls Back End or user opens browser</text><path d="M47,1829.4609 L47,1854.4609 L106,1854.4609 L106,1839.4609 L96,1829.4609 L47,1829.4609 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M96,1829.4609 L96,1839.4609 L106,1839.4609 L96,1829.4609 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="53" y="1846.5278">online</text><path d="M556.125,1866.5938 L822.5,1866.5938 L822.5,1873.7266 L812.5,1883.7266 L556.125,1883.7266 L556.125,1866.5938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="133.6641" style="stroke:#000000;stroke-width:1.5;" width="415.8125" x="556.125" y="1866.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="221.375" x="571.125" y="1879.6606">wallet processes consensus data</text><polygon fill="#181818" points="884.9375,1900.8594,894.9375,1904.8594,884.9375,1908.8594,888.9375,1904.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="593.625" x2="890.9375" y1="1904.8594" y2="1904.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="600.625" y="1899.7935">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="621.4375" y="1899.7935">sync</text><polygon fill="#181818" points="604.625,1929.9922,594.625,1933.9922,604.625,1937.9922,600.625,1933.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="598.625" x2="895.9375" y1="1933.9922" y2="1933.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="610.625" y="1928.9263">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="631.4375" y="1928.9263">public state, tx</text><polygon fill="#181818" points="792.4375,1959.125,802.4375,1963.125,792.4375,1967.125,796.4375,1963.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="593.625" x2="798.4375" y1="1963.125" y2="1963.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="600.625" y="1958.0591">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="621.4375" y="1958.0591">public state, tx</text><polygon fill="#181818" points="604.625,1988.2578,594.625,1992.2578,604.625,1996.2578,600.625,1992.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="598.625" x2="808.4375" y1="1992.2578" y2="1992.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="610.625" y="1987.1919">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="631.4375" y="1987.1919">ok</text><path d="M5,2012.2578 L5,2037.2578 L148,2037.2578 L148,2022.2578 L138,2012.2578 L5,2012.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M138,2012.2578 L138,2022.2578 L148,2022.2578 L138,2012.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="11" y="2029.3247">online, opens dApp</text><path d="M48,2049.3906 L352.4063,2049.3906 L352.4063,2056.5234 L342.4063,2066.5234 L48,2066.5234 L48,2049.3906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="289.1953" style="stroke:#000000;stroke-width:1.5;" width="583.125" x="48" y="2049.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="259.4063" x="63" y="2062.4575">dApp processes confirmed transaction</text><polygon fill="#181818" points="581.625,2083.6563,591.625,2087.6563,581.625,2091.6563,585.625,2087.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="255.3125" x2="587.625" y1="2087.6563" y2="2087.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="262.3125" y="2082.5903">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="283.125" y="2082.5903">refresh</text><polygon fill="#181818" points="266.3125,2112.7891,256.3125,2116.7891,266.3125,2120.7891,262.3125,2116.7891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="260.3125" x2="592.625" y1="2116.7891" y2="2116.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="272.3125" y="2111.7231">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="293.125" y="2111.7231">public state, tx</text><line style="stroke:#181818;stroke-width:1.0;" x1="255.3125" x2="297.3125" y1="2145.9219" y2="2145.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="297.3125" x2="297.3125" y1="2145.9219" y2="2158.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.3125" x2="297.3125" y1="2158.9219" y2="2158.9219"/><polygon fill="#181818" points="266.3125,2154.9219,256.3125,2158.9219,266.3125,2162.9219,262.3125,2158.9219" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="262.3125" y="2140.856">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="283.125" y="2140.856">install new public state</text><polygon fill="#181818" points="507.125,2184.0547,517.125,2188.0547,507.125,2192.0547,511.125,2188.0547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="255.3125" x2="513.125" y1="2188.0547" y2="2188.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="262.3125" y="2182.9888">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="283.125" y="2182.9888">fetch private transcript</text><polygon fill="#181818" points="266.3125,2213.1875,256.3125,2217.1875,266.3125,2221.1875,262.3125,2217.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="260.3125" x2="523.125" y1="2217.1875" y2="2217.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="272.3125" y="2212.1216">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="293.125" y="2212.1216">private transcript</text><line style="stroke:#181818;stroke-width:1.0;" x1="255.3125" x2="297.3125" y1="2246.3203" y2="2246.3203"/><line style="stroke:#181818;stroke-width:1.0;" x1="297.3125" x2="297.3125" y1="2246.3203" y2="2259.3203"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.3125" x2="297.3125" y1="2259.3203" y2="2259.3203"/><polygon fill="#181818" points="266.3125,2255.3203,256.3125,2259.3203,266.3125,2263.3203,262.3125,2259.3203" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="262.3125" y="2241.2544">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="283.125" y="2241.2544">apply private transcript</text><line style="stroke:#181818;stroke-width:1.0;" x1="255.3125" x2="297.3125" y1="2288.4531" y2="2288.4531"/><line style="stroke:#181818;stroke-width:1.0;" x1="297.3125" x2="297.3125" y1="2288.4531" y2="2301.4531"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.3125" x2="297.3125" y1="2301.4531" y2="2301.4531"/><polygon fill="#181818" points="266.3125,2297.4531,256.3125,2301.4531,266.3125,2305.4531,262.3125,2301.4531" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="262.3125" y="2283.3872">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="283.125" y="2283.3872">install new private state</text><polygon fill="#181818" points="87.5,2326.5859,77.5,2330.5859,87.5,2334.5859,83.5,2330.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="81.5" x2="254.3125" y1="2330.5859" y2="2330.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="93.5" y="2325.52">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="114.3125" y="2325.52">outcome information</text><rect height="58.2031" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="121" x="1407.375" y="5"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1525.375" y="14.2822">Â </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="121" x="1407.375" y="25.9229">2022.11.29 at 14:47 UTC</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1525.375" y="37.5635">Â </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1525.375" y="49.2041">Â </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1525.375" y="60.8447">Â </text><rect height="46.5625" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="225" x="651.6875" y="2454.4766"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="762.6875" y="2463.7588">Â </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="762.6875" y="2475.3994">Â </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="762.6875" y="2487.04">Â </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="225" x="651.6875" y="2498.6807">Copyright 2022, Input Output Hong Kong, Ltd.</text><!--MD5=[5c6e534678b160e8dd4e2042c3fd4180]
@startuml
autonumber
'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
' Please include this standard header
header %filename()\n%date("yyyy.MM.dd' at 'HH:mm z")\n\n\n
'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

actor user

box "dApp" #eef
        participant dApp as dapp
        participant "Transition\nFunction" as gamma
        database "Pending\nPrivate\nUpdates" as pending
end box
box "Wallet Frontend" #efe
        participant "Wallet" as wallet
        database "Client\nData" as clientData
end box
box "Wallet Backend"
    participant "Wallet Backend" as walletBackend
end box
box "Proof Server Component" #fee
        participant "Proof\nServer" as proofServer
end box

boundary Consensus as consensus

'==================================================================


user -> dapp : action

activate dapp
        /'
        ' group sync public and private state
        '         note over dapp
        '                 The dApp attempts to work with the
        '                 most current view of the blockchain,
        '                 synchronizing via the Wallet Backend
        '         end note
        '         dapp -> walletBackend : sync
        '         activate walletBackend
        '                 walletBackend -> dapp : public state,\nï¿½ï¿½ï¿½event ï¿½ï¿½ï¿½ transaction, ...ï¿½ï¿½ï¿½
        '         deactivate walletBackend
        '         /\'
        '         ' rnote over dapp #eee
        '         '         dApp:
        '         '           - install public state
        '         '           - update private state from
        '         '                ï¿½ï¿½ï¿½event ï¿½ï¿½ï¿½ transaction, ...ï¿½ï¿½ï¿½
        '         ' end rnote
        '         '\/
        ' end
        '/


        group compute and store a state update
            dapp -> gamma : update(args) using\n  public state,\n  private state
            activate gamma
                    gamma -> dapp : ok(result,\n     new public state,\n     new private state,\n     private transcript,\n     public transcript,\n     witness)
            deactivate gamma

            group over TLS, to TEE in proof server
                note over dapp: witness includes private data\nnot shared with Wallet
                dapp -> proofServer : prove(circuit, witness)
                note over proofServer: omitting details of\nsession management
                activate proofServer
                        proofServer -> dapp : proof
                deactivate proofServer
            end

            dapp -> pending ++ : store pending private\ntranscript indexed by tx
            return ok
        end

        group build and send transaction
                dapp -> wallet : make call tx (call, transcripts)
                activate wallet
                group identify payment
                            wallet -> clientData ++ : fetch coins
                            clientData -> wallet : coins
                        deactivate clientData
                        wallet -> wallet : estimate cost, select coins
                end

                group obtain authorization
                        note over wallet : now we have all the data needed to ask user for authorization\nthough a 2-stage process may be better suited:\n - first dApp asks if can interact with wallet at all(and user confirms or rejects)\n - then wallet asks user for each separate transaction
                        note over wallet: alternative flow: user pre-authorizes to avoid this step. \nDepending on time it takes to calculate SC ZK-proofs (steps 4, 5) \nthe user experience may require moving user authorization step earlier
                        wallet -> user : request authorization\nof leakage report & coins
                        user -> wallet : authorized
                end

                note over wallet: Now perform the expensive spend\nproofs to complete the transaction.
                group over TLS, to TEE in proof server
                        wallet -> proofServer : prove spend
                        activate proofServer
                                proofServer -> wallet : spendProof
                        deactivate proofServer
                end

                wallet -> wallet : build tx 'call' using\n  contractId,\n  public transcript,\n  proof,\n  coins
                wallet -> clientData ++ : savePending(tx)
                clientData -> wallet - - : ok
                note over walletBackend : omitting details of initialization and session management
                wallet -> walletBackend : submitTx(tx)
                activate walletBackend
                        walletBackend -> consensus : submitTx(call, circuitId, proof, spendIns, spendOuts, spendProof)
                        walletBackend -> wallet : submitted
                wallet -> dapp : submitted
                deactivate wallet
        end

        dapp -> user: pending

        == time passes as TX is verified and propageted ==

deactivate dapp


note over user: possibly offline

group Wallet Backend observes consensus
        consensus -> walletBackend : verified tx and new public state
        walletBackend -> walletBackend : store for client
end

== time passes until Wallet Front End polls Back End or user opens browser ==

note over user: online

'activation doesn't seem to work here
activate wallet

group wallet processes consensus data
    wallet -> walletBackend : sync
    walletBackend -> wallet :  public state, tx
    wallet -> clientData ++ : public state, tx
    clientData -> wallet - - : ok
end

deactivate walletBackend

note over user: online, opens dApp
group dApp processes confirmed transaction
    activate dapp
        dapp -> wallet: refresh
        wallet -> dapp: public state, tx
        dapp -> dapp : install new public state
        dapp -> pending ++ : fetch private transcript
        pending -> dapp - - : private transcript
        dapp -> dapp : apply private transcript
        dapp -> dapp : install new private state
        dapp -> user : outcome information
    deactivate dapp
end


'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
' Please include this standard footer
footer \n\n\nCopyright %date("yyyy"), Input Output Hong Kong, Ltd.
'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

@enduml

@startuml
autonumber
header \n2022.11.29 at 14:47 UTC\n\n\n

actor user

box "dApp" #eef
        participant dApp as dapp
        participant "Transition\nFunction" as gamma
        database "Pending\nPrivate\nUpdates" as pending
end box
box "Wallet Frontend" #efe
        participant "Wallet" as wallet
        database "Client\nData" as clientData
end box
box "Wallet Backend"
    participant "Wallet Backend" as walletBackend
end box
box "Proof Server Component" #fee
        participant "Proof\nServer" as proofServer
end box

boundary Consensus as consensus



user -> dapp : action

activate dapp


        group compute and store a state update
            dapp -> gamma : update(args) using\n  public state,\n  private state
            activate gamma
                    gamma -> dapp : ok(result,\n     new public state,\n     new private state,\n     private transcript,\n     public transcript,\n     witness)
            deactivate gamma

            group over TLS, to TEE in proof server
                note over dapp: witness includes private data\nnot shared with Wallet
                dapp -> proofServer : prove(circuit, witness)
                note over proofServer: omitting details of\nsession management
                activate proofServer
                        proofServer -> dapp : proof
                deactivate proofServer
            end

            dapp -> pending ++ : store pending private\ntranscript indexed by tx
            return ok
        end

        group build and send transaction
                dapp -> wallet : make call tx (call, transcripts)
                activate wallet
                group identify payment
                            wallet -> clientData ++ : fetch coins
                            clientData -> wallet : coins
                        deactivate clientData
                        wallet -> wallet : estimate cost, select coins
                end

                group obtain authorization
                        note over wallet : now we have all the data needed to ask user for authorization\nthough a 2-stage process may be better suited:\n - first dApp asks if can interact with wallet at all(and user confirms or rejects)\n - then wallet asks user for each separate transaction
                        note over wallet: alternative flow: user pre-authorizes to avoid this step. \nDepending on time it takes to calculate SC ZK-proofs (steps 4, 5) \nthe user experience may require moving user authorization step earlier
                        wallet -> user : request authorization\nof leakage report & coins
                        user -> wallet : authorized
                end

                note over wallet: Now perform the expensive spend\nproofs to complete the transaction.
                group over TLS, to TEE in proof server
                        wallet -> proofServer : prove spend
                        activate proofServer
                                proofServer -> wallet : spendProof
                        deactivate proofServer
                end

                wallet -> wallet : build tx 'call' using\n  contractId,\n  public transcript,\n  proof,\n  coins
                wallet -> clientData ++ : savePending(tx)
                clientData -> wallet - - : ok
                note over walletBackend : omitting details of initialization and session management
                wallet -> walletBackend : submitTx(tx)
                activate walletBackend
                        walletBackend -> consensus : submitTx(call, circuitId, proof, spendIns, spendOuts, spendProof)
                        walletBackend -> wallet : submitted
                wallet -> dapp : submitted
                deactivate wallet
        end

        dapp -> user: pending

        == time passes as TX is verified and propageted ==

deactivate dapp


note over user: possibly offline

group Wallet Backend observes consensus
        consensus -> walletBackend : verified tx and new public state
        walletBackend -> walletBackend : store for client
end

== time passes until Wallet Front End polls Back End or user opens browser ==

note over user: online

activate wallet

group wallet processes consensus data
    wallet -> walletBackend : sync
    walletBackend -> wallet :  public state, tx
    wallet -> clientData ++ : public state, tx
    clientData -> wallet - - : ok
end

deactivate walletBackend

note over user: online, opens dApp
group dApp processes confirmed transaction
    activate dapp
        dapp -> wallet: refresh
        wallet -> dapp: public state, tx
        dapp -> dapp : install new public state
        dapp -> pending ++ : fetch private transcript
        pending -> dapp - - : private transcript
        dapp -> dapp : apply private transcript
        dapp -> dapp : install new private state
        dapp -> user : outcome information
    deactivate dapp
end


footer \n\n\nCopyright 2022, Input Output Hong Kong, Ltd.

@enduml

PlantUML version 1.2022.3(Tue Mar 29 16:10:57 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1326px" preserveAspectRatio="none" style="width:1205px;height:1326px;background:#FFFFFF;" version="1.1" viewBox="0 0 1205 1326" width="1205px" zoomAndPan="magnify"><defs/><g><rect fill="#EEEEFF" height="1206.0703" style="stroke:#181818;stroke-width:0.5;" width="359.3125" x="162.8125" y="65.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="34.625" x="325.1563" y="77.27">dApp</text><rect fill="#EEFFFF" height="1206.0703" style="stroke:#181818;stroke-width:0.5;" width="323.3125" x="524.125" y="65.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.4375" x="665.5625" y="77.27">Wallet</text><rect fill="#FFEEEE" height="1206.0703" style="stroke:#181818;stroke-width:0.5;" width="172.125" x="849.4375" y="65.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166.125" x="852.4375" y="77.27">Proof Server Component</text><rect fill="#FFFFFF" height="1048.9141" style="stroke:#181818;stroke-width:1.0;" width="10" x="202.3125" y="210.3594"/><rect fill="#FFFFFF" height="89.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="398.125" y="293.8906"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="481.125" y="559.3516"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="481.125" y="1109.7422"/><rect fill="#FFFFFF" height="372.5938" style="stroke:#181818;stroke-width:1.0;" width="10" x="550.625" y="641.75"/><rect fill="#FFFFFF" height="1079.0469" style="stroke:#181818;stroke-width:1.0;" width="10" x="778.4375" y="189.2266"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="930.5" y="494.0859"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="930.5" y="695.0156"/><rect height="166.1953" style="stroke:#000000;stroke-width:1.5;fill:none;" width="297.3125" x="156.8125" y="225.3594"/><rect height="125.6641" style="stroke:#000000;stroke-width:1.5;fill:none;" width="880.5" x="94" y="405.5547"/><rect height="252.1953" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1032.0625" x="156.8125" y="603.4844"/><rect height="75.3984" style="stroke:#000000;stroke-width:1.5;fill:none;" width="456.375" x="518.125" y="656.75"/><rect height="201.7969" style="stroke:#000000;stroke-width:1.5;fill:none;" width="371.3125" x="156.8125" y="1029.3438"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="179.2266" y2="1277.2734"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="206.8125" x2="206.8125" y1="179.2266" y2="1277.2734"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="403.125" x2="403.125" y1="179.2266" y2="1277.2734"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="486.125" x2="486.125" y1="179.2266" y2="1277.2734"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="555.125" x2="555.125" y1="179.2266" y2="1277.2734"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="783.4375" x2="783.4375" y1="179.2266" y2="1277.2734"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="935.5" x2="935.5" y1="179.2266" y2="1277.2734"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1135.875" x2="1135.875" y1="179.2266" y2="1277.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="175.9248">user</text><ellipse cx="23.5" cy="111.4297" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,119.4297 L23.5,146.4297 M10.5,127.4297 L36.5,127.4297 M23.5,146.4297 L10.5,161.4297 M23.5,146.4297 L36.5,161.4297 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="166.8125" y="147.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="173.8125" y="167.9248">client-sdk</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="362.125" y="131.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="369.125" y="151.6279">Transition</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="373.125" y="167.9248">Function</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="454.625" y="143.3311">Pending</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="460.125" y="159.6279">Private</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="454.125" y="175.9248">Updates</text><path d="M468.125,94.3359 C468.125,84.3359 486.125,84.3359 486.125,84.3359 C486.125,84.3359 504.125,84.3359 504.125,94.3359 L504.125,120.3359 C504.125,130.3359 486.125,130.3359 486.125,130.3359 C486.125,130.3359 468.125,130.3359 468.125,120.3359 L468.125,94.3359 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M468.125,94.3359 C468.125,104.3359 486.125,104.3359 486.125,104.3359 C486.125,104.3359 504.125,104.3359 504.125,94.3359 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="55" x="528.125" y="147.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="535.125" y="167.9248">Wallet</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="120" x="723.4375" y="147.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="730.4375" y="167.9248">Wallet Backend</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="58" x="906.5" y="131.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="917.5" y="151.6279">Proof</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="913.5" y="167.9248">Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1093.875" y="175.9248">Consensus</text><path d="M1115.875,134.9297 L1115.875,158.9297 M1115.875,146.9297 L1132.875,146.9297 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="1144.875" cy="146.9297" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#FFFFFF" height="1048.9141" style="stroke:#181818;stroke-width:1.0;" width="10" x="202.3125" y="210.3594"/><rect fill="#FFFFFF" height="89.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="398.125" y="293.8906"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="481.125" y="559.3516"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="481.125" y="1109.7422"/><rect fill="#FFFFFF" height="372.5938" style="stroke:#181818;stroke-width:1.0;" width="10" x="550.625" y="641.75"/><rect fill="#FFFFFF" height="1079.0469" style="stroke:#181818;stroke-width:1.0;" width="10" x="778.4375" y="189.2266"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="930.5" y="494.0859"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="930.5" y="695.0156"/><polygon fill="#181818" points="190.3125,206.3594,200.3125,210.3594,190.3125,214.3594,194.3125,210.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="23.5" x2="196.3125" y1="210.3594" y2="210.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="30.5" y="205.2935">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="42.9063" y="205.2935">action</text><path d="M156.8125,225.3594 L364.5313,225.3594 L364.5313,232.4922 L354.5313,242.4922 L156.8125,242.4922 L156.8125,225.3594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="166.1953" style="stroke:#000000;stroke-width:1.5;" width="297.3125" x="156.8125" y="225.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="162.7188" x="171.8125" y="238.4263">compute a state update</text><polygon fill="#181818" points="386.125,289.8906,396.125,293.8906,386.125,297.8906,390.125,293.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="392.125" y1="293.8906" y2="293.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="219.3125" y="273.6919">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="231.7188" y="258.5591">update(args) using</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="239.7188" y="273.6919">public state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="239.7188" y="288.8247">private state</text><polygon fill="#181818" points="223.3125,379.5547,213.3125,383.5547,223.3125,387.5547,219.3125,383.5547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="217.3125" x2="402.125" y1="383.5547" y2="383.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="229.3125" y="348.2231">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="241.7188" y="317.9575">ok(result,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="261.7188" y="333.0903">private transcript,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="261.7188" y="348.2231">public transcript,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="261.7188" y="363.356">witness,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="261.7188" y="378.4888">gas estimate)</text><path d="M94,405.5547 L350.5625,405.5547 L350.5625,412.6875 L340.5625,422.6875 L94,422.6875 L94,405.5547 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="125.6641" style="stroke:#000000;stroke-width:1.5;" width="880.5" x="94" y="405.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="211.5625" x="109" y="418.6216">over TLS, to TEE in Proof Server</text><path d="M104,427.6875 L104,467.6875 L309,467.6875 L309,437.6875 L299,427.6875 L104,427.6875 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M299,427.6875 L299,437.6875 L309,437.6875 L299,427.6875 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="110" y="444.7544">witness includes private data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="110" y="459.8872">not shared with Wallet</text><polygon fill="#181818" points="918.5,490.0859,928.5,494.0859,918.5,498.0859,922.5,494.0859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="924.5" y1="494.0859" y2="494.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="219.3125" y="489.02">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="231.7188" y="489.02">prove(circuit, witness)</text><polygon fill="#181818" points="223.3125,519.2188,213.3125,523.2188,223.3125,527.2188,219.3125,523.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="217.3125" x2="934.5" y1="523.2188" y2="523.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="229.3125" y="518.1528">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="241.7188" y="518.1528">proof</text><polygon fill="#181818" points="469.125,555.3516,479.125,559.3516,469.125,563.3516,473.125,559.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="475.125" y1="559.3516" y2="559.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="219.3125" y="554.2856">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="231.7188" y="554.2856">store pending private transcript</text><polygon fill="#181818" points="223.3125,584.4844,213.3125,588.4844,223.3125,592.4844,219.3125,588.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="217.3125" x2="485.125" y1="588.4844" y2="588.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="229.3125" y="583.4185">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="241.7188" y="583.4185">ok</text><path d="M156.8125,603.4844 L380.1563,603.4844 L380.1563,610.6172 L370.1563,620.6172 L156.8125,620.6172 L156.8125,603.4844 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="252.1953" style="stroke:#000000;stroke-width:1.5;" width="1032.0625" x="156.8125" y="603.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="178.3438" x="171.8125" y="616.5513">build and send transaction</text><polygon fill="#181818" points="538.625,637.75,548.625,641.75,538.625,645.75,542.625,641.75" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="544.625" y1="641.75" y2="641.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="219.3125" y="636.6841">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="231.7188" y="636.6841">callTx(call, circuit)</text><path d="M518.125,656.75 L774.6875,656.75 L774.6875,663.8828 L764.6875,673.8828 L518.125,673.8828 L518.125,656.75 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="75.3984" style="stroke:#000000;stroke-width:1.5;" width="456.375" x="518.125" y="656.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="211.5625" x="533.125" y="669.8169">over TLS, to TEE in Proof Server</text><polygon fill="#181818" points="918.5,691.0156,928.5,695.0156,918.5,699.0156,922.5,695.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="560.625" x2="924.5" y1="695.0156" y2="695.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.4063" x="567.625" y="689.9497">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="580.0313" y="689.9497">prove(notesOwnership)</text><polygon fill="#181818" points="571.625,720.1484,561.625,724.1484,571.625,728.1484,567.625,724.1484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="565.625" x2="934.5" y1="724.1484" y2="724.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="577.625" y="719.0825">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="598.4375" y="719.0825">proof</text><polygon fill="#181818" points="766.4375,756.2813,776.4375,760.2813,766.4375,764.2813,770.4375,760.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="560.625" x2="772.4375" y1="760.2813" y2="760.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="567.625" y="755.2153">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="588.4375" y="755.2153">submitTx(tx)</text><polygon fill="#181818" points="1124.375,785.4141,1134.375,789.4141,1124.375,793.4141,1128.375,789.4141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="788.4375" x2="1130.375" y1="789.4141" y2="789.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="795.4375" y="784.3481">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="816.25" y="784.3481">submitTx(tx)</text><polygon fill="#181818" points="571.625,814.5469,561.625,818.5469,571.625,822.5469,567.625,818.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="565.625" x2="777.4375" y1="818.5469" y2="818.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="577.625" y="813.481">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="598.4375" y="813.481">pending</text><polygon fill="#181818" points="223.3125,843.6797,213.3125,847.6797,223.3125,851.6797,219.3125,847.6797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="217.3125" x2="549.625" y1="847.6797" y2="847.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="229.3125" y="842.6138">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="250.125" y="842.6138">pending</text><polygon fill="#181818" points="34.5,879.8125,24.5,883.8125,34.5,887.8125,30.5,883.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="28.5" x2="201.3125" y1="883.8125" y2="883.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="40.5" y="878.7466">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="61.3125" y="878.7466">pending</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1198.875" x="0" y="912.3789"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1198.875" y1="912.3789" y2="912.3789"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1198.875" y1="915.3789" y2="915.3789"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="319.0313" x="439.9219" y="901.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="301.0313" x="445.9219" y="917.8794">time passes as TX is verified and propageted</text><polygon fill="#181818" points="799.4375,952.0781,789.4375,956.0781,799.4375,960.0781,795.4375,956.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="793.4375" x2="1135.375" y1="956.0781" y2="956.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="805.4375" y="951.0122">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="826.25" y="951.0122">verified tx and new public state</text><polygon fill="#181818" points="571.625,981.2109,561.625,985.2109,571.625,989.2109,567.625,985.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="565.625" x2="777.4375" y1="985.2109" y2="985.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="577.625" y="980.145">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="598.4375" y="980.145">verified tx, new public state</text><polygon fill="#181818" points="223.3125,1010.3438,213.3125,1014.3438,223.3125,1018.3438,219.3125,1014.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="217.3125" x2="554.625" y1="1014.3438" y2="1014.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="229.3125" y="1009.2778">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="250.125" y="1009.2778">tx verified, new public state</text><path d="M156.8125,1029.3438 L410.9688,1029.3438 L410.9688,1036.4766 L400.9688,1046.4766 L156.8125,1046.4766 L156.8125,1029.3438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="201.7969" style="stroke:#000000;stroke-width:1.5;" width="371.3125" x="156.8125" y="1029.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="209.1563" x="171.8125" y="1042.4106">dApp processes consesus data</text><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="254.3125" y1="1067.6094" y2="1067.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="254.3125" x2="254.3125" y1="1067.6094" y2="1080.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.3125" x2="254.3125" y1="1080.6094" y2="1080.6094"/><polygon fill="#181818" points="223.3125,1076.6094,213.3125,1080.6094,223.3125,1084.6094,219.3125,1080.6094" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="219.3125" y="1062.5435">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="240.125" y="1062.5435">install new public state</text><polygon fill="#181818" points="469.125,1105.7422,479.125,1109.7422,469.125,1113.7422,473.125,1109.7422" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="475.125" y1="1109.7422" y2="1109.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="219.3125" y="1104.6763">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="240.125" y="1104.6763">fetch private transcript for the tx</text><polygon fill="#181818" points="223.3125,1134.875,213.3125,1138.875,223.3125,1142.875,219.3125,1138.875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="217.3125" x2="485.125" y1="1138.875" y2="1138.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="229.3125" y="1133.8091">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="250.125" y="1133.8091">private transcript for the tx</text><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="254.3125" y1="1168.0078" y2="1168.0078"/><line style="stroke:#181818;stroke-width:1.0;" x1="254.3125" x2="254.3125" y1="1168.0078" y2="1181.0078"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.3125" x2="254.3125" y1="1181.0078" y2="1181.0078"/><polygon fill="#181818" points="223.3125,1177.0078,213.3125,1181.0078,223.3125,1185.0078,219.3125,1181.0078" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="219.3125" y="1162.9419">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="240.125" y="1162.9419">apply private transcript</text><line style="stroke:#181818;stroke-width:1.0;" x1="212.3125" x2="254.3125" y1="1210.1406" y2="1210.1406"/><line style="stroke:#181818;stroke-width:1.0;" x1="254.3125" x2="254.3125" y1="1210.1406" y2="1223.1406"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.3125" x2="254.3125" y1="1223.1406" y2="1223.1406"/><polygon fill="#181818" points="223.3125,1219.1406,213.3125,1223.1406,223.3125,1227.1406,219.3125,1223.1406" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="219.3125" y="1205.0747">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="240.125" y="1205.0747">install new private state</text><polygon fill="#181818" points="34.5,1255.2734,24.5,1259.2734,34.5,1263.2734,30.5,1259.2734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="28.5" x2="206.3125" y1="1259.2734" y2="1259.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16.8125" x="40.5" y="1254.2075">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="61.3125" y="1254.2075">outcome information</text><rect height="58.2031" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="121" x="1076.875" y="5"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1194.875" y="14.2822"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="121" x="1076.875" y="25.9229">2022.11.29 at 14:47 UTC</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1194.875" y="37.5635"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1194.875" y="49.2041"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="1194.875" y="60.8447"> </text><rect height="46.5625" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="225" x="486.4375" y="1272.2734"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="597.4375" y="1281.5557"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="597.4375" y="1293.1963"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="597.4375" y="1304.8369"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="225" x="486.4375" y="1316.4775">Copyright 2022, Input Output Hong Kong, Ltd.</text><!--MD5=[0a105bca029ab76dfd0836e5eb32f4ba]
@startuml
autonumber
hide footbox

'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
' Please include this standard header
header %filename()\n%date("yyyy.MM.dd' at 'HH:mm z")\n\n\n
'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

actor user

'Dapp might be embedded/"installed" inside wallet, but even then it requires quite strong separation between wallet and dApp code
box "dApp" #eef
        participant "client-sdk" as clientSdk
        participant "Transition\nFunction" as gamma
        database "Pending\nPrivate\nUpdates" as pending
end box


box "Wallet" #eff
    'The browser extension
    participant "Wallet" as wallet
    'Wallet Backend, server component that works as a cache for frontend + bridge between frontend and the network
    participant "Wallet Backend" as walletBackend
end box
/'
 ' box "Wallet Backend Component" #efe
 '         participant "WBE\nClient API" as walletBackend
 '         database "Client\nData" as clientData
 ' end box
 '/
box "Proof Server Component" #fee
        participant "Proof\nServer" as proofServer
end box

boundary Consensus as consensus

'==================================================================
        ' Wallet Backend is always active, at least from perspective of this flow
        activate walletBackend

        user -> clientSdk : action

        activate clientSdk
        group compute a state update
                clientSdk -> gamma : update(args) using\n  public state,\n  private state
                activate gamma
                        gamma -> clientSdk : ok(result,\n     private transcript,\n     public transcript,\n     witness,\n     gas estimate)
                deactivate gamma
        end

        group over TLS, to TEE in Proof Server
                                note over clientSdk: witness includes private data\nnot shared with Wallet
                                clientSdk -> proofServer : prove(circuit, witness)
                                activate proofServer
                                        proofServer -> clientSdk : proof
                                deactivate proofServer
                        end

        clientSdk -> pending ++ : store pending private transcript
        return ok

        group build and send transaction
                clientSdk -> wallet : callTx(call, circuit)
                activate wallet
                group over TLS, to TEE in Proof Server
                        wallet -> proofServer : prove(notesOwnership)
                        activate proofServer
                                proofServer -> wallet : proof
                        deactivate proofServer
                end

                wallet -> walletBackend : submitTx(tx)
                walletBackend -> consensus : submitTx(tx)
                walletBackend -> wallet : pending
                wallet -> clientSdk : pending
        end

        clientSdk -> user: pending

        == time passes as TX is verified and propageted ==

        consensus -> walletBackend : verified tx and new public state
        walletBackend -> wallet : verified tx, new public state
        wallet -> clientSdk : tx verified, new public state

        deactivate wallet

        group dApp processes consesus data
                clientSdk -> clientSdk : install new public state
                clientSdk -> pending ++ : fetch private transcript for the tx
                pending -> clientSdk - - : private transcript for the tx
                clientSdk -> clientSdk : apply private transcript
                clientSdk -> clientSdk : install new private state
        end

        clientSdk -> user : outcome information
deactivate clientSdk


'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
' Please include this standard footer
footer \n\n\nCopyright %date("yyyy"), Input Output Hong Kong, Ltd.
'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

@enduml

@startuml
autonumber
hide footbox

header \n2022.11.29 at 14:47 UTC\n\n\n

actor user

box "dApp" #eef
        participant "client-sdk" as clientSdk
        participant "Transition\nFunction" as gamma
        database "Pending\nPrivate\nUpdates" as pending
end box


box "Wallet" #eff
    participant "Wallet" as wallet
    participant "Wallet Backend" as walletBackend
end box
box "Proof Server Component" #fee
        participant "Proof\nServer" as proofServer
end box

boundary Consensus as consensus

        activate walletBackend

        user -> clientSdk : action

        activate clientSdk
        group compute a state update
                clientSdk -> gamma : update(args) using\n  public state,\n  private state
                activate gamma
                        gamma -> clientSdk : ok(result,\n     private transcript,\n     public transcript,\n     witness,\n     gas estimate)
                deactivate gamma
        end

        group over TLS, to TEE in Proof Server
                                note over clientSdk: witness includes private data\nnot shared with Wallet
                                clientSdk -> proofServer : prove(circuit, witness)
                                activate proofServer
                                        proofServer -> clientSdk : proof
                                deactivate proofServer
                        end

        clientSdk -> pending ++ : store pending private transcript
        return ok

        group build and send transaction
                clientSdk -> wallet : callTx(call, circuit)
                activate wallet
                group over TLS, to TEE in Proof Server
                        wallet -> proofServer : prove(notesOwnership)
                        activate proofServer
                                proofServer -> wallet : proof
                        deactivate proofServer
                end

                wallet -> walletBackend : submitTx(tx)
                walletBackend -> consensus : submitTx(tx)
                walletBackend -> wallet : pending
                wallet -> clientSdk : pending
        end

        clientSdk -> user: pending

        == time passes as TX is verified and propageted ==

        consensus -> walletBackend : verified tx and new public state
        walletBackend -> wallet : verified tx, new public state
        wallet -> clientSdk : tx verified, new public state

        deactivate wallet

        group dApp processes consesus data
                clientSdk -> clientSdk : install new public state
                clientSdk -> pending ++ : fetch private transcript for the tx
                pending -> clientSdk - - : private transcript for the tx
                clientSdk -> clientSdk : apply private transcript
                clientSdk -> clientSdk : install new private state
        end

        clientSdk -> user : outcome information
deactivate clientSdk


footer \n\n\nCopyright 2022, Input Output Hong Kong, Ltd.

@enduml

PlantUML version 1.2022.3(Tue Mar 29 16:10:57 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="724px" preserveAspectRatio="none" style="width:1080px;height:724px;background:#FFFFFF;" version="1.1" viewBox="0 0 1080 724" width="1080px" zoomAndPan="magnify"><defs/><g><rect height="59.4648" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="105" x="486.75" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="5" x="536.75" y="28.5352"> </text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="95" x="491.75" y="45.0234">Join Contract</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="5" x="536.75" y="61.5117"> </text><rect height="88.9316" style="stroke:#000000;stroke-width:1.5;fill:none;" width="486" x="285.5" y="224.8848"/><rect height="88.9316" style="stroke:#000000;stroke-width:1.5;fill:none;" width="486" x="285.5" y="582.6113"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="51" x2="51" y1="106.9531" y2="688.543"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="350.5" x2="350.5" y1="106.9531" y2="688.543"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="710.5" x2="710.5" y1="106.9531" y2="688.543"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="852.5" x2="852.5" y1="106.9531" y2="688.543"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1009.5" x2="1009.5" y1="106.9531" y2="688.543"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="92" x="5" y="75.4648"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="12" y="96">Application</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="92" x="5" y="687.543"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="12" y="708.0781">Application</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="111" x="295.5" y="75.4648"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="302.5" y="96">Lares Backend</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="111" x="295.5" y="687.543"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="302.5" y="708.0781">Lares Backend</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101" x="660.5" y="75.4648"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="667.5" y="96">Filter Service</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101" x="660.5" y="687.543"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="667.5" y="708.0781">Filter Service</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="771.5" y="75.4648"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="778.5" y="96">Contract State Service</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="771.5" y="687.543"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="778.5" y="708.0781">Contract State Service</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130" x="944.5" y="75.4648"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="951.5" y="96">Contract Storage</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130" x="944.5" y="687.543"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="951.5" y="708.0781">Contract Storage</text><polygon fill="#181818" points="339,134.2637,349,138.2637,339,142.2637,343,138.2637" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="51" x2="345" y1="138.2637" y2="138.2637"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="63" y="133.5215">join(address, filter, privateStateConstructor)</text><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="393" y1="167.5742" y2="167.5742"/><line style="stroke:#181818;stroke-width:1.0;" x1="393" x2="393" y1="167.5742" y2="180.5742"/><line style="stroke:#181818;stroke-width:1.0;" x1="352" x2="393" y1="180.5742" y2="180.5742"/><polygon fill="#181818" points="362,176.5742,352,180.5742,362,184.5742,358,180.5742" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="358" y="162.832">events = []</text><polygon fill="#181818" points="699,205.8848,709,209.8848,699,213.8848,703,209.8848" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="705" y1="209.8848" y2="209.8848"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="476.5" y="205.1426">installFilter(filter)</text><path d="M285.5,224.8848 L359.5,224.8848 L359.5,232.1953 L349.5,242.1953 L285.5,242.1953 L285.5,224.8848 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="88.9316" style="stroke:#000000;stroke-width:1.5;" width="486" x="285.5" y="224.8848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="300.5" y="238.4531">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="141" x="374.5" y="237.5195">[Until all events are sent]</text><path d="M776.5,229.8848 L776.5,269.8848 L1024.5,269.8848 L1024.5,239.8848 L1014.5,229.8848 L776.5,229.8848 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1014.5,229.8848 L1014.5,239.8848 L1024.5,239.8848 L1014.5,229.8848 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="782.5" y="247.4531">The filter should specify when it no</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="782.5" y="262.7637">longer applies</text><polygon fill="#181818" points="362,259.5059,352,263.5059,362,267.5059,358,263.5059" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="356" x2="710" y1="263.5059" y2="263.5059"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="514" y="258.7637">event</text><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="393" y1="292.8164" y2="292.8164"/><line style="stroke:#181818;stroke-width:1.0;" x1="393" x2="393" y1="292.8164" y2="305.8164"/><line style="stroke:#181818;stroke-width:1.0;" x1="352" x2="393" y1="305.8164" y2="305.8164"/><polygon fill="#181818" points="362,301.8164,352,305.8164,362,309.8164,358,305.8164" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="358" y="288.0742">events = append(event, events)</text><polygon fill="#181818" points="841,338.127,851,342.127,841,346.127,845,342.127" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="847" y1="342.127" y2="342.127"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="536.5" y="337.3848">getContract(address)</text><polygon fill="#181818" points="362,367.4375,352,371.4375,362,375.4375,358,371.4375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="356" x2="852" y1="371.4375" y2="371.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="576" y="366.6953">contract</text><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="393" y1="400.748" y2="400.748"/><line style="stroke:#181818;stroke-width:1.0;" x1="393" x2="393" y1="400.748" y2="413.748"/><line style="stroke:#181818;stroke-width:1.0;" x1="352" x2="393" y1="413.748" y2="413.748"/><polygon fill="#181818" points="362,409.748,352,413.748,362,417.748,358,413.748" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="346" x="358" y="396.0059">contract.privateState = privateStateConstructor(events)</text><polygon fill="#181818" points="997.5,439.0586,1007.5,443.0586,997.5,447.0586,1001.5,443.0586" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="1003.5" y1="443.0586" y2="443.0586"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="605.75" y="438.3164">store(address, contract)</text><polygon fill="#181818" points="62,468.3691,52,472.3691,62,476.3691,58,472.3691" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="56" x2="350" y1="472.3691" y2="472.3691"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="189.5" y="467.627">end</text><polygon fill="#181818" points="699,515.9902,709,519.9902,699,523.9902,703,519.9902" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="705" y1="519.9902" y2="519.9902"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="443" y="515.248">installFilter(txsFor(address))</text><path d="M716,485.3691 L716,540.3691 L1004,540.3691 L1004,495.3691 L994,485.3691 L716,485.3691 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M994,485.3691 L994,495.3691 L1004,495.3691 L994,485.3691 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="722" y="502.9375">Should only return transactions from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263" x="722" y="518.248">blocks following the block corresponding</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="722" y="533.5586">to the previously returned state</text><polygon fill="#181818" points="362,563.6113,352,567.6113,362,571.6113,358,567.6113" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="356" x2="710" y1="567.6113" y2="567.6113"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="520" y="562.8691">ack</text><path d="M285.5,582.6113 L359.5,582.6113 L359.5,589.9219 L349.5,599.9219 L285.5,599.9219 L285.5,582.6113 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="88.9316" style="stroke:#000000;stroke-width:1.5;" width="486" x="285.5" y="582.6113"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="300.5" y="596.1797">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="75" x="374.5" y="595.2461">[Until unjoin]</text><polygon fill="#181818" points="362,617.2324,352,621.2324,362,625.2324,358,621.2324" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="356" x2="710" y1="621.2324" y2="621.2324"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13" x="524.5" y="616.4902">tx</text><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="393" y1="650.543" y2="650.543"/><line style="stroke:#181818;stroke-width:1.0;" x1="393" x2="393" y1="650.543" y2="663.543"/><line style="stroke:#181818;stroke-width:1.0;" x1="352" x2="393" y1="663.543" y2="663.543"/><polygon fill="#181818" points="362,659.543,352,663.543,362,667.543,358,663.543" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="358" y="645.8008">apply(tx)</text><!--MD5=[71397c217892017caecb9547d5bf2a83]
@startuml Join Contract

skinparam SequenceMessageAlignment center

title

  Join Contract

end title

"Application" -> "Lares Backend" : join(address, filter, privateStateConstructor)
"Lares Backend" -> "Lares Backend" : events = []
"Lares Backend" -> "Filter Service" : installFilter(filter)
loop Until all events are sent
  "Filter Service" -> "Lares Backend" : event
  "Lares Backend" -> "Lares Backend" : events = append(event, events)
end
note right
The filter should specify when it no 
longer applies
end note
"Lares Backend" -> "Contract State Service" : getContract(address)
"Contract State Service" - -> "Lares Backend" : contract
"Lares Backend" -> "Lares Backend": contract.privateState = privateStateConstructor(events)
"Lares Backend" -> "Contract Storage" : store(address, contract)
"Lares Backend" - -> "Application" : end
"Lares Backend" -> "Filter Service" : installFilter(txsFor(address))
note right
Should only return transactions from 
blocks following the block corresponding 
to the previously returned state
end note
"Filter Service" - -> "Lares Backend" : ack
loop Until unjoin
  "Filter Service" -> "Lares Backend" : tx
  "Lares Backend" -> "Lares Backend" : apply(tx)
end
@enduml

PlantUML version 1.2022.5(Sat Apr 30 06:55:52 EDT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>